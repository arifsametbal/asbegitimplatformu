import React, { useState, useEffect, useMemo } from 'react';
import { 
  BookOpen, Calculator, FlaskConical, Globe, Users, Languages, 
  Brain, Palette, Music, Activity, LogOut, Plus, Trash2, Play, 
  BarChart3, UserCog, Save, Gamepad2, ArrowLeft, Loader2,
  // Yeni Oyun ƒ∞√ßin Eklenen ƒ∞konlar:
  Snowflake, Wind, Trophy, RotateCcw, Clock, CheckCircle, XCircle, Grid, Type, ChevronLeft, Book, Search
} from 'lucide-react';

// --- YAPILANDIRMA ---
// Google Apps Script Web App URL'si (G√ºncellendi)
const API_URL = "https://script.google.com/macros/s/AKfycbzsrmvGlnyaZY8qS0fE76VKTNF0Ivd_G8VRHFJJCVnd7FcNS3aVzGD82qC8oS0R-bS2/exec";

// --- G√ñM√úL√ú OYUN KODLARI HAVUZU ---
// Buraya yeni oyunlarƒ±nƒ±n HTML kodlarƒ±nƒ± ekleyebilirsin.
// Sheet'teki 'id' s√ºtunu ile buradaki anahtar (key) e≈üle≈ümelidir.

// --- 1. ƒ∞NGƒ∞Lƒ∞ZCE OYUNU KODU ---
const ENGLISH_GAME_SOURCE = `
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3. Sƒ±nƒ±f ƒ∞ngilizce Fun Hub</title>
    <style>
        :root { --primary: #FF9F1C; --secondary: #2EC4B6; --accent: #E71D36; --dark: #011627; --light: #FDFFFC; --bg: #E0F7FA; --correct: #4CAF50; --wrong: #F44336; }
        body { font-family: 'Comic Sans MS', 'Verdana', sans-serif; background-color: var(--bg); margin: 0; padding: 10px; text-align: center; user-select: none; color: var(--dark); }
        .container { max-width: 600px; margin: 0 auto; background: var(--light); border-radius: 20px; padding: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); border-bottom: 6px solid var(--secondary); min-height: 80vh; }
        h1 { color: var(--accent); margin: 10px 0; font-size: 1.8rem; text-shadow: 2px 2px 0px #ffd1d1; }
        h3 { margin: 10px 0; color: var(--dark); }
        .menu-box { background: #fff8e1; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 2px dashed var(--primary); }
        select { padding: 12px; font-size: 16px; border-radius: 10px; border: 2px solid var(--primary); width: 100%; background: white; cursor: pointer; font-family: inherit; }
        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { border: none; padding: 15px; font-size: 16px; border-radius: 15px; cursor: pointer; font-weight: bold; color: white; transition: transform 0.1s; font-family: inherit; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        .btn:active { transform: translateY(3px); box-shadow: none !important; }
        .btn-card { background-color: var(--primary); } .btn-quiz { background-color: var(--secondary); } .btn-memory { background-color: #9C27B0; } .btn-scramble { background-color: #FF5722; }
        .btn-back { background-color: #E0E0E0; color: #333; box-shadow: 0 3px 0 #BDBDBD; font-size: 14px; padding: 8px 15px; border-radius: 20px; margin-right: auto; }
        .icon-lg { font-size: 24px; margin-bottom: 5px; }
        #game-area { display: none; }
        .game-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee; }
        .score-badge { background: var(--dark); color: white; padding: 5px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .card-scene { width: 100%; max-width: 300px; height: 220px; perspective: 1000px; margin: 20px auto; cursor: pointer; }
        .card-inner { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 20px; box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .is-flipped .card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 20px; font-size: 24px; font-weight: bold; }
        .card-front { background: var(--primary); color: white; }
        .card-back { background: var(--accent); color: white; transform: rotateY(180deg); }
        .emoji-lg { font-size: 80px; display: block; }
        .question-box { background: #fff3e0; padding: 15px; border-radius: 15px; margin-bottom: 15px; font-size: 20px; font-weight: bold; border: 2px solid var(--primary); }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-btn { background: white; border: 2px solid #ddd; padding: 12px; border-radius: 12px; font-size: 16px; cursor: pointer; font-weight: bold; color: #444; font-family: inherit; }
        .correct { background: var(--correct) !important; color: white !important; border-color: #2E7D32 !important; }
        .wrong { background: var(--wrong) !important; color: white !important; border-color: #C62828 !important; }
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
        .mem-card { aspect-ratio: 1; background: var(--secondary); border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; color: transparent; position: relative; transition: transform 0.2s; box-shadow: 0 3px 0 rgba(0,0,0,0.1); }
        .mem-card.flipped { background: white; color: var(--dark); border: 2px solid var(--secondary); transform: rotateY(180deg); }
        .mem-card.matched { background: var(--correct); color: white; border-color: var(--correct); visibility: visible; animation: pop 0.3s ease; }
        @keyframes pop { 50% { transform: scale(1.1); } }
        .scramble-box { margin-top: 20px; }
        .target-emoji { font-size: 60px; margin-bottom: 10px; }
        .target-hint { font-size: 18px; color: #666; margin-bottom: 20px; }
        .answer-area { min-height: 50px; border-bottom: 3px solid var(--dark); margin-bottom: 20px; display: flex; justify-content: center; gap: 5px; }
        .letter-tile { width: 40px; height: 40px; background: var(--primary); color: white; font-size: 20px; font-weight: bold; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; box-shadow: 0 3px 0 #cc7a00; }
        .letter-tile.used { opacity: 0.3; cursor: default; transform: scale(0.9); box-shadow: none; }
        .letter-pool { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
        .feedback-area { height: 40px; margin: 10px 0; font-weight: bold; font-size: 18px; display: flex; justify-content: center; align-items: center; }
        .btn-next { background: var(--secondary); color: white; width: 100%; padding: 12px; border-radius: 10px; display: none; margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Fun English</h1>
    <div id="menu-screen">
        <div class="menu-box"><h3>1. Adƒ±m: √únite Se√ß</h3><select id="unit-select"></select></div>
        <div class="menu-box"><h3>2. Adƒ±m: Oyun Se√ß</h3><div class="game-grid"><button class="btn btn-card" onclick="startGame('flashcards')"><span class="icon-lg">üÉè</span>Kartlar</button><button class="btn btn-quiz" onclick="startGame('quiz')"><span class="icon-lg">‚ùì</span>Test</button><button class="btn btn-memory" onclick="startGame('memory')"><span class="icon-lg">üß†</span>Hafƒ±za</button><button class="btn btn-scramble" onclick="startGame('scramble')"><span class="icon-lg">üî§</span>Kelime Bul</button></div></div>
    </div>
    <div id="game-area">
        <div class="game-header"><button class="btn btn-back" onclick="goHome()">‚¨Ö Men√º</button><div id="game-title" style="font-weight:bold; color:var(--secondary)">Unit Title</div><div class="score-badge" id="score-display">Puan: 0</div></div>
        <div id="mode-flashcards" style="display:none"><div class="card-scene" onclick="flipCard()"><div class="card-inner" id="card-inner"><div class="card-face card-front"><span class="emoji-lg" id="fc-emoji">üê∂</span><span id="fc-word">Dog</span><span style="font-size:12px; margin-top:10px; opacity:0.8">(√áevir)</span></div><div class="card-face card-back"><span class="emoji-lg" id="fc-emoji-back">üê∂</span><span id="fc-trans">K√∂pek</span></div></div></div><div style="margin-top:20px; display:flex; justify-content:center; gap:15px; align-items:center;"><button class="btn btn-back" style="float:none; width:auto;" onclick="prevCard()">‚ùÆ Geri</button><span id="fc-counter" style="font-weight:bold">1/10</span><button class="btn btn-back" style="float:none; width:auto;" onclick="nextCard()">ƒ∞leri ‚ùØ</button></div></div>
        <div id="mode-quiz" style="display:none; max-width:500px; margin:0 auto;"><div class="question-box"><div id="q-emoji" style="font-size:40px; margin-bottom:5px;"></div><div id="q-text">Soru buraya gelecek</div></div><div class="options-grid" id="q-options"></div></div>
        <div id="mode-memory" style="display:none"><div style="margin-bottom:10px; font-size:14px; color:#666;">Kartlarƒ± e≈üle≈ütirin!</div><div class="memory-grid" id="memory-grid"></div></div>
        <div id="mode-scramble" style="display:none" class="scramble-box"><div class="target-emoji" id="sc-emoji">üçé</div><div class="target-hint" id="sc-hint">Elma</div><div class="answer-area" id="sc-answer"></div><div class="letter-pool" id="sc-pool"></div></div>
        <div class="feedback-area" id="global-feedback"></div><button class="btn btn-next" id="global-next-btn" onclick="nextStep()">Devam Et ‚û°</button>
    </div>
</div>
<script>
    const curriculum = {
        u1: { title: "Unit 1: Greeting", words: [{ en: "Hello", tr: "Merhaba", emo: "üëã" }, { en: "Good morning", tr: "G√ºnaydƒ±n", emo: "‚òÄÔ∏è" }, { en: "Good night", tr: "ƒ∞yi geceler", emo: "üåô" }, { en: "Name", tr: "ƒ∞sim", emo: "üè∑Ô∏è" }, { en: "Fine", tr: "ƒ∞yi", emo: "üëç" }, { en: "Goodbye", tr: "Ho≈ü√ßakal", emo: "üö∂" }, { en: "Spell", tr: "Hecelemek", emo: "üî§" }, { en: "Friend", tr: "Arkada≈ü", emo: "üë´" }] },
        u2: { title: "Unit 2: My Family", words: [{ en: "Mother", tr: "Anne", emo: "üë©" }, { en: "Father", tr: "Baba", emo: "üë®" }, { en: "Sister", tr: "Kƒ±z karde≈ü", emo: "üëß" }, { en: "Brother", tr: "Erkek karde≈ü", emo: "üë¶" }, { en: "Grandmother", tr: "B√ºy√ºkanne", emo: "üëµ" }, { en: "Grandfather", tr: "B√ºy√ºkbaba", emo: "üë¥" }, { en: "Uncle", tr: "Amca", emo: "üßî" }, { en: "Aunt", tr: "Hala", emo: "üë±‚Äç‚ôÄÔ∏è" }] },
        u3: { title: "Unit 3: People I Love", words: [{ en: "Big", tr: "B√ºy√ºk", emo: "üêò" }, { en: "Small", tr: "K√º√ß√ºk", emo: "üêú" }, { en: "Tall", tr: "Uzun", emo: "ü¶í" }, { en: "Short", tr: "Kƒ±sa", emo: "üêß" }, { en: "Strong", tr: "G√º√ßl√º", emo: "üí™" }, { en: "Weak", tr: "G√º√ßs√ºz", emo: "ü•Ä" }, { en: "Fast", tr: "Hƒ±zlƒ±", emo: "üêÜ" }, { en: "Slow", tr: "Yava≈ü", emo: "üê¢" }] },
        u4: { title: "Unit 4: Feelings", words: [{ en: "Happy", tr: "Mutlu", emo: "üòä" }, { en: "Sad", tr: "√úzg√ºn", emo: "üò¢" }, { en: "Angry", tr: "Kƒ±zgƒ±n", emo: "üò°" }, { en: "Tired", tr: "Yorgun", emo: "üò´" }, { en: "Surprised", tr: "≈ûa≈ükƒ±n", emo: "üò≤" }, { en: "Hungry", tr: "A√ß", emo: "üòã" }, { en: "Thirsty", tr: "Susamƒ±≈ü", emo: "ü•§" }, { en: "Scared", tr: "Korkmu≈ü", emo: "üò±" }] },
        u5: { title: "Unit 5: Toys & Games", words: [{ en: "Toy", tr: "Oyuncak", emo: "üß∏" }, { en: "Ball", tr: "Top", emo: "‚öΩ" }, { en: "Doll", tr: "Bebek", emo: "üéé" }, { en: "Kite", tr: "U√ßurtma", emo: "ü™Å" }, { en: "Bike", tr: "Bisiklet", emo: "üö≤" }, { en: "Train", tr: "Tren", emo: "üöÇ" }, { en: "Car", tr: "Araba", emo: "üöó" }, { en: "Teddy Bear", tr: "Ayƒ±", emo: "üêª" }] },
        u6: { title: "Unit 6: My House", words: [{ en: "House", tr: "Ev", emo: "üè†" }, { en: "Living room", tr: "Oturma odasƒ±", emo: "üõãÔ∏è" }, { en: "Kitchen", tr: "Mutfak", emo: "üç≥" }, { en: "Bedroom", tr: "Yatak odasƒ±", emo: "üõèÔ∏è" }, { en: "Bathroom", tr: "Banyo", emo: "üõÅ" }, { en: "Garden", tr: "Bah√ße", emo: "üå≥" }, { en: "Sofa", tr: "Kanepe", emo: "üõãÔ∏è" }, { en: "Table", tr: "Masa", emo: "üçΩÔ∏è" }] },
        u7: { title: "Unit 7: In My City", words: [{ en: "City", tr: "≈ûehir", emo: "üèôÔ∏è" }, { en: "School", tr: "Okul", emo: "üè´" }, { en: "Park", tr: "Park", emo: "üå≥" }, { en: "Hospital", tr: "Hastane", emo: "üè•" }, { en: "Museum", tr: "M√ºze", emo: "üèõÔ∏è" }, { en: "Zoo", tr: "Hayvanat Bah√ßesi", emo: "ü¶Å" }, { en: "Market", tr: "Market", emo: "üõí" }, { en: "Library", tr: "K√ºt√ºphane", emo: "üìö" }] },
        u8: { title: "Unit 8: Transportation", words: [{ en: "Bus", tr: "Otob√ºs", emo: "üöå" }, { en: "Train", tr: "Tren", emo: "üöÜ" }, { en: "Plane", tr: "U√ßak", emo: "‚úàÔ∏è" }, { en: "Ship", tr: "Gemi", emo: "üö¢" }, { en: "Boat", tr: "Tekne", emo: "üõ∂" }, { en: "Helicopter", tr: "Helikopter", emo: "üöÅ" }, { en: "Car", tr: "Araba", emo: "üöó" }, { en: "Taxi", tr: "Taksi", emo: "üöï" }] },
        u9: { title: "Unit 9: Weather", words: [{ en: "Sunny", tr: "G√ºne≈üli", emo: "‚òÄÔ∏è" }, { en: "Rainy", tr: "Yaƒümurlu", emo: "üåßÔ∏è" }, { en: "Cloudy", tr: "Bulutlu", emo: "‚òÅÔ∏è" }, { en: "Snowy", tr: "Karlƒ±", emo: "‚òÉÔ∏è" }, { en: "Windy", tr: "R√ºzgarlƒ±", emo: "üçÉ" }, { en: "Hot", tr: "Sƒ±cak", emo: "ü•µ" }, { en: "Cold", tr: "Soƒüuk", emo: "ü•∂" }, { en: "Wet", tr: "Islak", emo: "üíß" }] },
        u10: { title: "Unit 10: Nature", words: [{ en: "Nature", tr: "Doƒüa", emo: "üèûÔ∏è" }, { en: "Tree", tr: "Aƒüa√ß", emo: "üå≥" }, { en: "Flower", tr: "√ái√ßek", emo: "üåª" }, { en: "River", tr: "Nehir", emo: "üåä" }, { en: "Mountain", tr: "Daƒü", emo: "‚õ∞Ô∏è" }, { en: "Forest", tr: "Orman", emo: "üå≤" }, { en: "Bee", tr: "Arƒ±", emo: "üêù" }, { en: "Frog", tr: "Kurbaƒüa", emo: "üê∏" }] }
    };
    let currentUnit = null; let activeMode = ''; let score = 0; let quizQueue = []; let qIndex = 0; let memCards = []; let flippedCards = []; let matchedCount = 0; let isLocked = false; let scWord = null; let scUserAnswer = [];
    window.onload = () => { const select = document.getElementById("unit-select"); for (let key in curriculum) { let opt = document.createElement("option"); opt.value = key; opt.innerText = curriculum[key].title; select.appendChild(opt); } };
    function startGame(mode) { const uKey = document.getElementById("unit-select").value; currentUnit = curriculum[uKey]; activeMode = mode; score = 0; updateScore(0); document.getElementById("menu-screen").style.display = "none"; document.getElementById("game-area").style.display = "block"; document.getElementById("game-title").innerText = currentUnit.title; ['flashcards', 'quiz', 'memory', 'scramble'].forEach(m => { document.getElementById(\`mode-\${m}\`).style.display = "none"; }); setFeedback(""); document.getElementById("global-next-btn").style.display = "none"; if (mode === 'flashcards') initFlashcards(); else if (mode === 'quiz') initQuiz(); else if (mode === 'memory') initMemory(); else if (mode === 'scramble') initScramble(); }
    function goHome() { document.getElementById("game-area").style.display = "none"; document.getElementById("menu-screen").style.display = "block"; }
    function updateScore(val) { score = val; document.getElementById("score-display").innerText = "Puan: " + score; }
    function setFeedback(msg, color='black') { const el = document.getElementById("global-feedback"); el.innerHTML = msg; el.style.color = color; }
    let fcIndex = 0; function initFlashcards() { document.getElementById("mode-flashcards").style.display = "block"; fcIndex = 0; renderFlashcard(); } function renderFlashcard() { const w = currentUnit.words[fcIndex]; document.getElementById("fc-emoji").innerText = w.emo; document.getElementById("fc-word").innerText = w.en; document.getElementById("fc-emoji-back").innerText = w.emo; document.getElementById("fc-trans").innerText = w.tr; document.getElementById("fc-counter").innerText = \`\${fcIndex+1} / \${currentUnit.words.length}\`; document.querySelector(".card-scene").classList.remove("is-flipped"); } function flipCard() { document.querySelector(".card-scene").classList.toggle("is-flipped"); } function nextCard() { if(fcIndex < currentUnit.words.length-1) { fcIndex++; renderFlashcard(); } } function prevCard() { if(fcIndex > 0) { fcIndex--; renderFlashcard(); } }
    function initQuiz() { document.getElementById("mode-quiz").style.display = "block"; quizQueue = []; currentUnit.words.forEach(w => { quizQueue.push({ type: 'en-tr', word: w }); quizQueue.push({ type: 'tr-en', word: w }); }); quizQueue.sort(() => Math.random() - 0.5); quizQueue = quizQueue.slice(0, 10); qIndex = 0; renderQuizQuestion(); } function renderQuizQuestion() { if (qIndex >= quizQueue.length) { setFeedback("Test Bitti! Harika ƒ∞≈ü! üéâ", "var(--correct)"); document.getElementById("mode-quiz").style.display = "none"; document.getElementById("global-next-btn").style.display = "none"; return; } const q = quizQueue[qIndex]; const w = q.word; let qText = ""; let correctAns = ""; let distractors = []; if (q.type === 'en-tr') { qText = \`"\${w.en}" kelimesinin anlamƒ± nedir?\`; correctAns = w.tr; distractors = currentUnit.words.filter(x => x.en !== w.en).map(x => x.tr); } else { qText = \`"\${w.tr}" kelimesinin ƒ∞ngilizcesi nedir?\`; correctAns = w.en; distractors = currentUnit.words.filter(x => x.en !== w.en).map(x => x.en); } document.getElementById("q-text").innerText = qText; document.getElementById("q-emoji").innerText = w.emo; let opts = [correctAns]; distractors.sort(() => Math.random() - 0.5); opts = opts.concat(distractors.slice(0, 3)); opts.sort(() => Math.random() - 0.5); const grid = document.getElementById("q-options"); grid.innerHTML = ""; opts.forEach(opt => { let btn = document.createElement("button"); btn.className = "option-btn"; btn.innerText = opt; btn.onclick = () => checkQuiz(btn, opt, correctAns); grid.appendChild(btn); }); setFeedback(""); document.getElementById("global-next-btn").style.display = "none"; } function checkQuiz(btn, selected, correct) { if (document.getElementById("global-next-btn").style.display === "block") return; const allBtns = document.querySelectorAll(".option-btn"); if (selected === correct) { btn.classList.add("correct"); updateScore(score + 10); setFeedback("Doƒüru! üëè", "green"); } else { btn.classList.add("wrong"); setFeedback("Yanlƒ±≈ü üòî", "red"); allBtns.forEach(b => { if(b.innerText === correct) b.classList.add("correct"); }); } document.getElementById("global-next-btn").style.display = "block"; }
    function initMemory() { document.getElementById("mode-memory").style.display = "block"; let selection = [...currentUnit.words].sort(() => Math.random() - 0.5).slice(0, 6); memCards = []; selection.forEach((w, i) => { memCards.push({ id: i, text: w.en, type: 'en', pairId: i }); memCards.push({ id: i, text: w.tr, type: 'tr', pairId: i }); }); memCards.sort(() => Math.random() - 0.5); const grid = document.getElementById("memory-grid"); grid.innerHTML = ""; flippedCards = []; matchedCount = 0; isLocked = false; memCards.forEach((card, index) => { let el = document.createElement("div"); el.className = "mem-card"; el.dataset.index = index; el.innerText = card.text; el.onclick = () => clickMemCard(el, card); grid.appendChild(el); }); } function clickMemCard(el, card) { if (isLocked) return; if (el.classList.contains("flipped") || el.classList.contains("matched")) return; el.classList.add("flipped"); flippedCards.push({ el, card }); if (flippedCards.length === 2) { isLocked = true; checkMatch(); } } function checkMatch() { const c1 = flippedCards[0]; const c2 = flippedCards[1]; if (c1.card.pairId === c2.card.pairId) { setTimeout(() => { c1.el.classList.add("matched"); c2.el.classList.add("matched"); flippedCards = []; isLocked = false; updateScore(score + 20); matchedCount++; if (matchedCount === memCards.length / 2) { setFeedback("Tebrikler! Hepsi E≈üle≈üti! üéâ", "green"); } }, 500); } else { setTimeout(() => { c1.el.classList.remove("flipped"); c2.el.classList.remove("flipped"); flippedCards = []; isLocked = false; }, 1000); } }
    function initScramble() { document.getElementById("mode-scramble").style.display = "block"; quizQueue = [...currentUnit.words].sort(() => Math.random() - 0.5); qIndex = 0; renderScramble(); } function renderScramble() { if (qIndex >= quizQueue.length) { setFeedback("Oyun Bitti! üî§", "green"); document.getElementById("mode-scramble").style.display = "none"; document.getElementById("global-next-btn").style.display = "none"; return; } const w = quizQueue[qIndex]; scWord = w.en.toUpperCase().replace(/ /g, ''); document.getElementById("sc-emoji").innerText = w.emo; document.getElementById("sc-hint").innerText = w.tr; document.getElementById("sc-answer").innerHTML = ""; let letters = scWord.split('').map((l, i) => ({ char: l, id: i })); letters.sort(() => Math.random() - 0.5); const pool = document.getElementById("sc-pool"); pool.innerHTML = ""; letters.forEach(item => { let tile = document.createElement("div"); tile.className = "letter-tile"; tile.innerText = item.char; tile.onclick = () => clickLetter(tile, item.char); pool.appendChild(tile); }); scUserAnswer = []; setFeedback(""); document.getElementById("global-next-btn").style.display = "none"; } function clickLetter(tile, char) { if (tile.classList.contains("used")) return; let ansTile = document.createElement("div"); ansTile.className = "letter-tile"; ansTile.innerText = char; ansTile.style.cursor = "default"; ansTile.onclick = () => { }; document.getElementById("sc-answer").appendChild(ansTile); tile.classList.add("used"); scUserAnswer.push(char); if (scUserAnswer.length === scWord.length) { if (scUserAnswer.join('') === scWord) { setFeedback("Harika! Doƒüru Yazdƒ±n! ‚ú®", "green"); updateScore(score + 15); document.getElementById("global-next-btn").style.display = "block"; } else { setFeedback("Yanlƒ±≈ü oldu, tekrar dene! üîÑ", "red"); setTimeout(() => { document.getElementById("sc-answer").innerHTML = ""; scUserAnswer = []; document.querySelectorAll("#sc-pool .letter-tile").forEach(t => t.classList.remove("used")); setFeedback(""); }, 1500); } } }
    function nextStep() { if (activeMode === 'quiz') { qIndex++; renderQuizQuestion(); } else if (activeMode === 'scramble') { qIndex++; renderScramble(); } }
</script>
</body>
</html>
`;

// --- G√ñM√úL√ú OYUN KODU 2: Galaktik Kelimeler ---
const TURKISH_SYNONYM_GAME_SOURCE = `
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaktik Kelimeler</title>
    <style>
        :root { --bg-deep: #0B0E14; --bg-gradient: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%); --glass: rgba(255, 255, 255, 0.1); --glass-border: rgba(255, 255, 255, 0.2); --primary: #00d2ff; --secondary: #9b59b6; --accent: #e94560; --text: #ffffff; --text-muted: #a0a0a0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background: var(--bg-deep); background-image: radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 4px), radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 3px), radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 4px); background-size: 550px 550px, 350px 350px, 250px 250px; background-position: 0 0, 40px 60px, 130px 270px; color: var(--text); min-height: 100vh; }
        header { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); padding: 1rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; z-index: 100; }
        .header-title { font-size: 1.5rem; font-weight: bold; background: linear-gradient(90deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; text-shadow: 0 0 10px rgba(0, 210, 255, 0.3); }
        .home-btn { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: 0.3s; display: none; }
        .home-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }
        .timer-display { background: rgba(233, 69, 96, 0.2); color: var(--accent); padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 1.2rem; border: 1px solid var(--accent); box-shadow: 0 0 10px rgba(233, 69, 96, 0.4); display: none; animation: pulse 1s infinite alternate; }
        @keyframes pulse { from { box-shadow: 0 0 5px var(--accent); } to { box-shadow: 0 0 15px var(--accent); } }
        .container { max-width: 900px; margin: 40px auto; padding: 30px; background: var(--glass); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border-radius: 20px; border: 1px solid var(--glass-border); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); min-height: 500px; text-align: center; }
        h2 { color: var(--primary); margin-top: 0; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
        p { color: var(--text-muted); }
        .game-section { display: none; animation: slideIn 0.5s; }
        .game-section.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .home-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; margin-top: 40px; }
        .game-card { background: rgba(255, 255, 255, 0.05); padding: 25px; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; border: 1px solid transparent; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 180px; position: relative; overflow: hidden; }
        .game-card:hover { transform: translateY(-10px); background: rgba(255, 255, 255, 0.1); border-color: var(--primary); box-shadow: 0 0 20px rgba(0, 210, 255, 0.2); }
        .game-icon { font-size: 3.5rem; margin-bottom: 15px; filter: drop-shadow(0 0 5px rgba(255,255,255,0.5)); }
        .game-card h3 { margin: 10px 0 5px 0; color: var(--text); }
        .game-card p { font-size: 0.9rem; color: var(--text-muted); }
        .settings-panel { background: rgba(0,0,0,0.3); border-radius: 15px; padding: 20px; margin-bottom: 30px; border: 1px solid var(--glass-border); display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .slider-container { width: 100%; max-width: 400px; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: var(--primary); cursor: pointer; margin-top: -8px; box-shadow: 0 0 10px var(--primary); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: var(--glass-border); border-radius: 2px; }
        .timer-value { font-size: 1.5rem; color: var(--primary); font-weight: bold; font-family: monospace; }
        .question-box { font-size: 3rem; margin: 30px 0; color: var(--text); font-weight: bold; text-shadow: 0 0 15px var(--secondary); letter-spacing: 2px; }
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .option-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text); padding: 20px; font-size: 1.3rem; cursor: pointer; border-radius: 12px; transition: 0.2s; position: relative; overflow: hidden; }
        .option-btn:hover { background: rgba(255,255,255,0.15); border-color: var(--primary); }
        .option-btn.correct { background: rgba(46, 204, 113, 0.3); border-color: #2ecc71; box-shadow: 0 0 15px #2ecc71; }
        .option-btn.wrong { background: rgba(231, 76, 60, 0.3); border-color: #e74c3c; box-shadow: 0 0 15px #e74c3c; }
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; perspective: 1000px; }
        .memory-card { background: linear-gradient(135deg, #2b1055, #7597de); height: 110px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; font-weight: bold; transform: scale(1); transition: transform 0.4s; transform-style: preserve-3d; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; }
        .memory-card::after { content: "üåå"; font-size: 2rem; position: absolute; backface-visibility: hidden; }
        .memory-card.flipped { transform: rotateY(180deg); background: white; color: #2c3e50; }
        .memory-card.flipped::after { content: ""; }
        .memory-card span { display: none; }
        .memory-card.flipped span { display: block; transform: rotateY(180deg); }
        .memory-card.matched { background: var(--primary); color: #000; opacity: 0; cursor: default; pointer-events: none; }
        .input-area { margin-top: 30px; display: flex; justify-content: center; gap: 10px; }
        input[type="text"] { padding: 15px; font-size: 1.2rem; border: 2px solid var(--glass-border); border-radius: 10px; background: rgba(0,0,0,0.3); color: white; width: 60%; text-align: center; outline: none; transition: 0.3s; }
        input[type="text"]:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 210, 255, 0.3); }
        .scramble-display { font-size: 2rem; font-weight: bold; letter-spacing: 5px; color: var(--primary); min-height: 50px; margin-bottom: 20px; border-bottom: 2px solid var(--glass-border); display: inline-block; padding: 0 20px; }
        .scramble-letters { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .letter-btn { width: 50px; height: 50px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid var(--primary); color: white; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 10px rgba(0, 210, 255, 0.2); }
        .letter-btn:hover { background: var(--primary); color: black; transform: scale(1.1); }
        .letter-btn:disabled { opacity: 0.3; cursor: not-allowed; transform: scale(0.9); border-color: #555; }
        .action-btn { padding: 10px 25px; font-size: 1.1rem; background: linear-gradient(45deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 10px; cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; }
        .action-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--primary); }
        .feedback { margin-top: 20px; font-weight: bold; font-size: 1.2rem; min-height: 30px; text-shadow: 0 0 5px rgba(0,0,0,0.8); }
        .score-board { font-size: 1.4rem; color: var(--secondary); font-weight: bold; margin-bottom: 20px; }
        .word-list-preview { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; max-height: 200px; overflow-y: auto; text-align: left; }
        .word-list-preview div { padding: 5px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        ::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }
        @media (max-width: 600px) { .options-grid, .memory-grid { grid-template-columns: 1fr; } .memory-grid { grid-template-columns: repeat(3, 1fr); } .input-area { flex-direction: column; } input[type="text"] { width: 100%; box-sizing: border-box; } }
    </style>
</head>
<body>
<header>
    <div class="header-title" onclick="goHome()">ü™ê Galaktik Kelimeler</div>
    <div style="display: flex; align-items: center; gap: 15px;">
        <div id="game-timer" class="timer-display">60</div>
        <button class="home-btn" id="back-btn" onclick="goHome()">üè† Ana Men√º</button>
    </div>
</header>
<div class="container">
    <div id="home" class="game-section active">
        <h2>G√∂rev Kontrol Merkezi</h2>
        <p>Uzay yolculuƒüuna ba≈ülamadan √∂nce hazƒ±rlƒ±klarƒ±nƒ± yap.</p>
        <div class="settings-panel">
            <label style="color: var(--primary); font-weight: bold;">‚è≥ G√∂rev S√ºresi</label>
            <div class="slider-container"><input type="range" min="10" max="180" value="60" step="10" id="time-slider" oninput="updateTimeDisplay(this.value)"></div>
            <div style="font-size: 0.9rem;">Se√ßilen S√ºre: <span id="time-val" class="timer-value">60</span> saniye</div>
            <div style="font-size: 0.8rem; color: #aaa;">(0 yapƒ±lƒ±rsa s√ºre sƒ±nƒ±rsƒ±z olur)</div>
        </div>
        <div class="home-grid">
            <div class="game-card" onclick="startGame('quiz')"><div class="game-icon">üõ∏</div><h3>Kelime Avcƒ±sƒ±</h3><p>Doƒüru sinyali yakala.</p></div>
            <div class="game-card" onclick="startGame('memory')"><div class="game-icon">üåå</div><h3>Hafƒ±za Nebulasƒ±</h3><p>Kayƒ±p ikizleri e≈üle≈ütir.</p></div>
            <div class="game-card" onclick="startGame('scramble')"><div class="game-icon">üß©</div><h3>≈ûifre √á√∂z√ºc√º</h3><p>Karƒ±≈üƒ±k sinyali d√ºzelt.</p></div>
            <div class="game-card" onclick="startGame('typing')"><div class="game-icon">üë®‚ÄçüöÄ</div><h3>Kod Yazƒ±cƒ±sƒ±</h3><p>Manuel giri≈ü yap.</p></div>
            <div class="game-card" onclick="startGame('add')" style="border-color: var(--secondary);"><div class="game-icon">‚òÑÔ∏è</div><h3>Yeni Ke≈üif</h3><p>Veritabanƒ±na kelime ekle.</p></div>
        </div>
    </div>
    <div id="quiz" class="game-section"><h2>Kelime Avcƒ±sƒ±</h2><div class="score-board">Skor: <span id="quiz-score">0</span></div><div class="question-box" id="quiz-word">KELƒ∞ME</div><div class="options-grid" id="quiz-options"></div><div class="feedback" id="quiz-feedback"></div></div>
    <div id="memory" class="game-section"><h2>Hafƒ±za Nebulasƒ±</h2><p>Kartlarƒ± √ßevir, evrendeki e≈üleri bul.</p><button class="action-btn" style="margin-bottom: 20px;" onclick="initMemoryGame()">Sistemi Yenile</button><div class="memory-grid" id="memory-board"></div></div>
    <div id="typing" class="game-section"><h2>Kod Yazƒ±cƒ±sƒ±</h2><div class="score-board">Skor: <span id="typing-score">0</span></div><div class="question-box" id="typing-word">KELƒ∞ME</div><div class="input-area"><input type="text" id="typing-input" placeholder="E≈ü anlamlƒ±sƒ±nƒ± gir..." autocomplete="off"><button class="action-btn" onclick="checkTypingAnswer()">G√∂nder</button></div><div class="feedback" id="typing-feedback"></div><button class="action-btn" style="margin-top:20px; background: transparent; border:1px solid white;" onclick="initTypingGame()">Rotayƒ± Atla</button></div>
    <div id="scramble" class="game-section"><h2>≈ûifre √á√∂z√ºc√º</h2><p>Harflere tƒ±klayarak doƒüru sƒ±ralamayƒ± bul.</p><div class="score-board">Skor: <span id="scramble-score">0</span></div><div class="question-box" id="scramble-word">KELƒ∞ME</div><div class="scramble-display" id="scramble-input-display"></div><div class="scramble-letters" id="scramble-letters-area"></div><div class="feedback" id="scramble-feedback"></div><div style="margin-top:20px;"><button class="action-btn" onclick="resetScrambleInput()" style="background:var(--secondary); font-size: 0.9rem;">Temizle</button><button class="action-btn" onclick="initScrambleGame()" style="margin-left:10px; background: transparent; border:1px solid white; font-size: 0.9rem;">Pas Ge√ß</button></div></div>
    <div id="add" class="game-section"><h2>Yeni Ke≈üif Ekle</h2><p>Galaktik s√∂zl√ºƒüe yeni veri giri≈üi yap.</p><div class="add-word-form" style="max-width: 400px; margin: 0 auto; display:flex; flex-direction:column; gap:10px;"><input type="text" id="new-word" placeholder="Kelime (√ñrn: Siyah)"><input type="text" id="new-synonym" placeholder="E≈ü Anlamlƒ±sƒ± (√ñrn: Kara)"><button class="action-btn" onclick="addNewWordPair()">Veritabanƒ±na Kaydet</button></div><div style="margin-top: 15px; color: var(--primary); font-weight: bold;" id="add-msg"></div><h3>Ke≈üfedilen Kelimeler (<span id="total-words">0</span>)</h3><div class="word-list-preview" id="word-list-display"></div></div>
</div>
<script>
    const defaultData = [ { word: "Beyaz", synonym: "Ak" }, { word: "Siyah", synonym: "Kara" }, { word: "Kƒ±rmƒ±zƒ±", synonym: "Al" }, { word: "√ñƒürenci", synonym: "Talebe" }, { word: "Okul", synonym: "Mektep" }, { word: "Doktor", synonym: "Hekim" }, { word: "Ya≈ülƒ±", synonym: "ƒ∞htiyar" }, { word: "Konuk", synonym: "Misafir" }, { word: "Hediye", synonym: "Armaƒüan" }, { word: "Yƒ±l", synonym: "Sene" }, { word: "Sonbahar", synonym: "G√ºz" }, { word: "Doƒüa", synonym: "Tabiat" }, { word: "R√ºzgar", synonym: "Yel" }, { word: "Kalp", synonym: "Y√ºrek" }, { word: "Uzak", synonym: "Irak" }, { word: "Dil", synonym: "Lisan" }, { word: "Nehir", synonym: "Irmak" }, { word: "Vakit", synonym: "Zaman" }, { word: "√ñyk√º", synonym: "Hikaye" }, { word: "Cevap", synonym: "Yanƒ±t" }, { word: "Soru", synonym: "Sual" }, { word: "Ad", synonym: "ƒ∞sim" }, { word: "Anƒ±", synonym: "Hatƒ±ra" }, { word: "Y√ºzyƒ±l", synonym: "Asƒ±r" }, { word: "G√∂rev", synonym: "Vazife" }, { word: "Barƒ±≈ü", synonym: "Sulh" }, { word: "Sava≈ü", synonym: "Harp" }, { word: "√úlke", synonym: "Memleket" }, { word: "≈ûehir", synonym: "Kent" }, { word: "Millet", synonym: "Ulus" }, { word: "Hayat", synonym: "Ya≈üam" }, { word: "Sƒ±nav", synonym: "ƒ∞mtihan" }, { word: "Deprem", synonym: "Zelzele" }, { word: "Fakir", synonym: "Yoksul" }, { word: "Zengin", synonym: "Varlƒ±klƒ±" }, { word: "Ama√ß", synonym: "Gaye" }, { word: "Ara√ß", synonym: "Vasƒ±ta" }, { word: "Bellek", synonym: "Hafƒ±za" }, { word: "Uyarƒ±", synonym: "ƒ∞kaz" }, { word: "Kelime", synonym: "S√∂zc√ºk" }, { word: "C√ºmle", synonym: "T√ºmce" }, { word: "Eser", synonym: "Yapƒ±t" }, { word: "√ñƒü√ºt", synonym: "Nasihat" }, { word: "T√∂ren", synonym: "Merasim" }, { word: "Saƒülƒ±k", synonym: "Sƒ±hhat" }, { word: "R√ºya", synonym: "D√º≈ü" }, { word: "Gelecek", synonym: "ƒ∞stikbal" }, { word: "Ge√ßmi≈ü", synonym: "Mazi" }, { word: "√ñzg√ºrl√ºk", synonym: "H√ºrriyet" }, { word: "Lider", synonym: "√ñnder" }, { word: "Ba≈ü", synonym: "Kafa" }, { word: "V√ºcut", synonym: "Beden" }, { word: "Surat", synonym: "Y√ºz" }, { word: "Kolay", synonym: "Basit" }, { word: "Zor", synonym: "G√º√ß" }, { word: "G√º√ßl√º", synonym: "Kuvvetli" }, { word: "Zayƒ±f", synonym: "Cƒ±lƒ±z" }, { word: "Temiz", synonym: "Pak" }, { word: "Kirli", synonym: "Pis" }, { word: "Islak", synonym: "Ya≈ü" }, { word: "Aktif", synonym: "Etkin" }, { word: "Orijinal", synonym: "√ñzg√ºn" }, { word: "Cimri", synonym: "Pinti" }, { word: "C√∂mert", synonym: "Eli a√ßƒ±k" }, { word: "Cesur", synonym: "Y√ºrekli" }, { word: "Korkak", synonym: "√ñdlek" }, { word: "Akƒ±l", synonym: "Us" }, { word: "Deli", synonym: "√áƒ±lgƒ±n" }, { word: "Mutlu", synonym: "Mesut" }, { word: "√úzg√ºn", synonym: "Mahzun" }, { word: "Sinirli", synonym: "√ñfkeli" }, { word: "Sakin", synonym: "Durgun" }, { word: "Hƒ±zlƒ±", synonym: "S√ºratli" }, { word: "Yava≈ü", synonym: "Aheste" }, { word: "Geni≈ü", synonym: "Bol" }, { word: "Dost", synonym: "Arkada≈ü" }, { word: "D√º≈üman", synonym: "Hasƒ±m" }, { word: "Fayda", synonym: "Yarar" }, { word: "Zarar", synonym: "Ziyan" }, { word: "K√¢r", synonym: "Kazan√ß" }, { word: "ƒ∞lgi", synonym: "Alaka" }, { word: "ƒ∞li≈üki", synonym: "M√ºnasebet" }, { word: "Kanƒ±t", synonym: "Delil" }, { word: "Kanun", synonym: "Yasa" }, { word: "Kural", synonym: "Kaide" }, { word: "Teori", synonym: "Kuram" }, { word: "Ku≈üku", synonym: "≈û√ºphe" }, { word: "Medeniyet", synonym: "Uygarlƒ±k" }, { word: "Mesafe", synonym: "Ara" }, { word: "Meslek", synonym: "ƒ∞≈ü" }, { word: "Sonu√ß", synonym: "Netice" }, { word: "Olay", synonym: "Vaka" }, { word: "Olasƒ±lƒ±k", synonym: "ƒ∞htimal" }, { word: "Onarƒ±m", synonym: "Tamir" }, { word: "√ñneri", synonym: "Teklif" }, { word: "√ñrnek", synonym: "Misal" }, { word: "√ñzlem", synonym: "Hasret" }, { word: "Problem", synonym: "Sorun" }, { word: "Rutubet", synonym: "Nem" }, { word: "≈ûahit", synonym: "Tanƒ±k" }, { word: "≈ûans", synonym: "Talih" }, { word: "≈ûart", synonym: "Ko≈üul" }, { word: "Tanƒ±m", synonym: "Tarif" }, { word: "Taraf", synonym: "Yan" }, { word: "Tecr√ºbe", synonym: "Deneyim" }, { word: "Tedbir", synonym: "√ñnlem" }, { word: "Temel", synonym: "Esas" }, { word: "Terc√ºme", synonym: "√áeviri" }, { word: "Toplum", synonym: "Cemiyet" }, { word: "Umut", synonym: "√úmit" }, { word: "Yetenek", synonym: "Kabiliyet" }, { word: "Y√∂ntem", synonym: "Metot" } ];
    let storedData = null; try { storedData = JSON.parse(localStorage.getItem('spaceSynonymGame')); } catch(e){}
    let wordList;
    if (storedData && storedData.length > defaultData.length) { wordList = storedData; } else { wordList = defaultData; try { localStorage.setItem('spaceSynonymGame', JSON.stringify(wordList)); } catch(e){} }
    let timerInterval; let selectedDuration = 60;
    function updateTimeDisplay(val) { document.getElementById('time-val').textContent = val; selectedDuration = parseInt(val); }
    function goHome() { clearInterval(timerInterval); document.getElementById('game-timer').style.display = 'none'; document.getElementById('back-btn').style.display = 'none'; document.querySelectorAll('.game-section').forEach(sec => sec.classList.remove('active')); document.getElementById('home').classList.add('active'); }
    function startGame(gameId) { document.querySelectorAll('.game-section').forEach(sec => sec.classList.remove('active')); document.getElementById(gameId).classList.add('active'); if(gameId !== 'home') { document.getElementById('back-btn').style.display = 'block'; } if(gameId === 'quiz') { initQuiz(); startTimer(); } if(gameId === 'memory') { initMemoryGame(); startTimer(); } if(gameId === 'typing') { initTypingGame(); startTimer(); } if(gameId === 'scramble') { initScrambleGame(); startTimer(); } if(gameId === 'add') updateWordListUI(); }
    function startTimer() { clearInterval(timerInterval); let timeLeft = selectedDuration; if (timeLeft == 0) { document.getElementById('game-timer').style.display = 'none'; return; } const timerDisplay = document.getElementById('game-timer'); timerDisplay.style.display = 'block'; timerDisplay.textContent = timeLeft; timerInterval = setInterval(() => { timeLeft--; timerDisplay.textContent = timeLeft; if (timeLeft <= 0) { clearInterval(timerInterval); alert("üö® Oksijen Bitti! G√∂rev Ba≈üarƒ±sƒ±z."); goHome(); } }, 1000); }
    function getRandomItem(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
    function saveToLocal() { try { localStorage.setItem('spaceSynonymGame', JSON.stringify(wordList)); } catch(e){} updateWordListUI(); }
    let quizScore = 0; let currentQuizItem = null; let quizLocked = false; 
    function initQuiz() { quizLocked = false; currentQuizItem = getRandomItem(wordList); document.getElementById('quiz-word').textContent = currentQuizItem.word; document.getElementById('quiz-feedback').textContent = ""; let options = [currentQuizItem.synonym]; let potentialWrongs = wordList.filter(i => i.synonym !== currentQuizItem.synonym).map(i => i.synonym); potentialWrongs = shuffleArray(potentialWrongs).slice(0, 3); options = options.concat(potentialWrongs); options = shuffleArray(options); const container = document.getElementById('quiz-options'); container.innerHTML = ''; options.forEach(opt => { const btn = document.createElement('div'); btn.className = 'option-btn'; btn.textContent = opt; btn.onclick = () => checkQuizAnswer(btn, opt); container.appendChild(btn); }); }
    function checkQuizAnswer(btn, answer) { if (quizLocked) return; quizLocked = true; const allBtns = document.querySelectorAll('.option-btn'); if (answer === currentQuizItem.synonym) { btn.classList.add('correct'); document.getElementById('quiz-feedback').textContent = "Sinyal Doƒürulandƒ±! ‚úÖ"; document.getElementById('quiz-feedback').style.color = "#2ecc71"; quizScore += 10; setTimeout(initQuiz, 1000); } else { btn.classList.add('wrong'); allBtns.forEach(b => { if(b.textContent === currentQuizItem.synonym) b.classList.add('correct'); }); document.getElementById('quiz-feedback').textContent = "Hatalƒ± Sinyal! Puan D√º≈ü√ºld√º. ‚ùå"; document.getElementById('quiz-feedback').style.color = "#e74c3c"; quizScore = Math.max(0, quizScore - 5); setTimeout(initQuiz, 2000); } document.getElementById('quiz-score').textContent = quizScore; }
    let hasFlippedCard = false; let lockBoard = false; let firstCard, secondCard;
    function initMemoryGame() { const board = document.getElementById('memory-board'); board.innerHTML = ''; let gamePairs = shuffleArray([...wordList]).slice(0, 6); let deck = []; gamePairs.forEach(pair => { deck.push({ text: pair.word, pairId: pair.word }); deck.push({ text: pair.synonym, pairId: pair.word }); }); deck = shuffleArray(deck); deck.forEach(item => { const card = document.createElement('div'); card.className = 'memory-card'; card.innerHTML = \`<span>\${item.text}</span>\`; card.dataset.pairId = item.pairId; card.addEventListener('click', flipCard); board.appendChild(card); }); [hasFlippedCard, lockBoard] = [false, false]; [firstCard, secondCard] = [null, null]; }
    function flipCard() { if (lockBoard) return; if (this === firstCard) return; this.classList.add('flipped'); if (!hasFlippedCard) { hasFlippedCard = true; firstCard = this; return; } secondCard = this; checkForMatch(); }
    function checkForMatch() { let isMatch = firstCard.dataset.pairId === secondCard.dataset.pairId; isMatch ? disableCards() : unflipCards(); }
    function disableCards() { firstCard.classList.add('matched'); secondCard.classList.add('matched'); resetBoard(); const allMatched = document.querySelectorAll('.memory-card.matched').length; const totalCards = document.querySelectorAll('.memory-card').length; if(allMatched === totalCards) { clearInterval(timerInterval); setTimeout(() => alert("üöÄ G√∂rev Ba≈üarƒ±lƒ±! T√ºm sistemler aktif."), 500); } }
    function unflipCards() { lockBoard = true; setTimeout(() => { firstCard.classList.remove('flipped'); secondCard.classList.remove('flipped'); resetBoard(); }, 1000); }
    function resetBoard() { [hasFlippedCard, lockBoard] = [false, false]; [firstCard, secondCard] = [null, null]; }
    let typingScore = 0; let currentTypingItem = null;
    function initTypingGame() { currentTypingItem = getRandomItem(wordList); document.getElementById('typing-word').textContent = currentTypingItem.word; document.getElementById('typing-input').value = ""; document.getElementById('typing-input').focus(); document.getElementById('typing-feedback').textContent = ""; }
    function checkTypingAnswer() { const inputVal = document.getElementById('typing-input').value.trim().toLocaleLowerCase('tr'); const correctVal = currentTypingItem.synonym.toLocaleLowerCase('tr'); const feedback = document.getElementById('typing-feedback'); if (inputVal === correctVal) { feedback.textContent = "Kod Kabul Edildi! ‚úÖ"; feedback.style.color = "#2ecc71"; typingScore += 10; document.getElementById('typing-score').textContent = typingScore; setTimeout(initTypingGame, 1000); } else { feedback.textContent = \`Hata! Doƒürusu: \${currentTypingItem.synonym}\`; feedback.style.color = "#e74c3c"; typingScore = Math.max(0, typingScore - 5); document.getElementById('typing-score').textContent = typingScore; setTimeout(initTypingGame, 2000); } }
    document.getElementById('typing-input').addEventListener("keypress", function(event) { if (event.key === "Enter") checkTypingAnswer(); });
    let scrambleScore = 0; let currentScrambleItem = null; let scrambleUserAnswer = "";
    function initScrambleGame() { scrambleUserAnswer = ""; currentScrambleItem = getRandomItem(wordList); document.getElementById('scramble-word').textContent = currentScrambleItem.word; document.getElementById('scramble-feedback').textContent = ""; updateScrambleDisplay(); const lettersArea = document.getElementById('scramble-letters-area'); lettersArea.innerHTML = ''; let cleanSynonym = currentScrambleItem.synonym.replace(/\\s+/g, '').toUpperCase(); let letters = cleanSynonym.split(''); letters = shuffleArray(letters); letters.forEach((char, index) => { const btn = document.createElement('button'); btn.className = 'letter-btn'; btn.textContent = char; btn.onclick = () => handleScrambleClick(btn, char); lettersArea.appendChild(btn); }); }
    function handleScrambleClick(btn, char) { scrambleUserAnswer += char; btn.disabled = true; updateScrambleDisplay(); checkScrambleStatus(); }
    function updateScrambleDisplay() { document.getElementById('scramble-input-display').textContent = scrambleUserAnswer; }
    function resetScrambleInput() { scrambleUserAnswer = ""; updateScrambleDisplay(); const btns = document.querySelectorAll('.letter-btn'); btns.forEach(b => b.disabled = false); document.getElementById('scramble-feedback').textContent = ""; }
    function checkScrambleStatus() { const correct = currentScrambleItem.synonym.replace(/\\s+/g, '').toLocaleUpperCase('tr'); if (scrambleUserAnswer.length === correct.length) { if (scrambleUserAnswer === correct) { document.getElementById('scramble-feedback').textContent = "≈ûifre √á√∂z√ºld√º! ‚úÖ"; document.getElementById('scramble-feedback').style.color = "#2ecc71"; scrambleScore += 10; document.getElementById('scramble-score').textContent = scrambleScore; setTimeout(initScrambleGame, 1000); } else { document.getElementById('scramble-feedback').textContent = "Yanlƒ±≈ü Dizilim! Tekrar Dene. ‚ùå"; document.getElementById('scramble-feedback').style.color = "#e74c3c"; scrambleScore = Math.max(0, scrambleScore - 5); document.getElementById('scramble-score').textContent = scrambleScore; setTimeout(resetScrambleInput, 1500); } } }
    function addNewWordPair() { const wInput = document.getElementById('new-word'); const sInput = document.getElementById('new-synonym'); const msg = document.getElementById('add-msg'); if (wInput.value.trim() && sInput.value.trim()) { const format = (str) => str.charAt(0).toLocaleUpperCase('tr') + str.slice(1).toLocaleLowerCase('tr'); const newItem = { word: format(wInput.value.trim()), synonym: format(sInput.value.trim()) }; wordList.push(newItem); saveToLocal(); msg.textContent = "Veri Kaydedildi!"; wInput.value = ''; sInput.value = ''; setTimeout(() => msg.textContent = '', 3000); } else { alert("Eksik veri giri≈üi!"); } }
    function updateWordListUI() { document.getElementById('total-words').textContent = wordList.length; const listDiv = document.getElementById('word-list-display'); let html = [...wordList].reverse().map(item => \`<div><strong>\${item.word}</strong> ‚áÑ \${item.synonym}</div>\`).join(''); listDiv.innerHTML = html; }
    goHome();
</script>
</body>
</html>
`;

// --- G√ñM√úL√ú OYUN KODLARI HAVUZU ---
const LOCAL_GAME_CODES = {
  'fun-english': ENGLISH_GAME_SOURCE,
  'static-turkish-synonyms-galactic': TURKISH_SYNONYM_GAME_SOURCE
};

// --- T√úRK√áE OYUNU VERƒ∞TABANI VE Bƒ∞LE≈ûENƒ∞ (GlacierAntonymsHub - Buzul Oyunu) ---
const synonymsDB = {
  "cevap": ["yanƒ±t"], "siyah": ["kara"], "beyaz": ["ak"], "kƒ±rmƒ±zƒ±": ["al"], "fakir": ["yoksul"],
  "zengin": ["varlƒ±klƒ±"], "ihtiyar": ["ya≈ülƒ±"], "ya≈ülƒ±": ["ihtiyar"], "gen√ß": ["toy", "delikanlƒ±"],
  "okul": ["mektep"], "√∂ƒürenci": ["talebe"], "doktor": ["hekim"], "y√ºrek": ["kalp"], "kalp": ["y√ºrek"],
  "armaƒüan": ["hediye"], "hediye": ["armaƒüan"], "ulus": ["millet"], "millet": ["ulus"], "kelime": ["s√∂zc√ºk"],
  "c√ºmle": ["t√ºmce"], "konuk": ["misafir"], "misafir": ["konuk"], "sava≈ü": ["harp"], "barƒ±≈ü": ["sulh"],
  "cimri": ["pintis"], "c√∂mert": ["eli a√ßƒ±k"], "ƒ±slak": ["ya≈ü"], "kuru": ["nemsiz"], "temiz": ["pak"],
  "kirli": ["pis"], "zor": ["g√º√ß"], "kolay": ["basit"], "fayda": ["yarar"], "zarar": ["ziyan"],
  "√∂zg√ºr": ["h√ºr"], "tutsak": ["esir"]
};

const antonymPairs = [
  { word: "Acƒ±", antonym: "Tatlƒ±" }, { word: "A√ßƒ±k", antonym: "Kapalƒ±" }, { word: "Aƒüƒ±r", antonym: "Hafif" },
  { word: "Ak", antonym: "Kara" }, { word: "Aktif", antonym: "Pasif" }, { word: "Al√ßak", antonym: "Y√ºksek" },
  { word: "Alt", antonym: "√úst" }, { word: "Artƒ±", antonym: "Eksi" }, { word: "A≈üaƒüƒ±", antonym: "Yukarƒ±" },
  { word: "Aynƒ±", antonym: "Farklƒ±" }, { word: "Az", antonym: "√áok" }, { word: "Barƒ±≈ü", antonym: "Sava≈ü" },
  { word: "Ba≈ülamak", antonym: "Bitirmek" }, { word: "Beyaz", antonym: "Siyah" }, { word: "B√ºy√ºk", antonym: "K√º√ß√ºk" },
  { word: "Cesur", antonym: "Korkak" }, { word: "C√∂mert", antonym: "Cimri" }, { word: "√áalƒ±≈ükan", antonym: "Tembel" },
  { word: "√áirkin", antonym: "G√ºzel" }, { word: "Dahil", antonym: "Hari√ß" }, { word: "Dar", antonym: "Geni≈ü" },
  { word: "Derin", antonym: "Sƒ±ƒü" }, { word: "Dolu", antonym: "Bo≈ü" }, { word: "Dost", antonym: "D√º≈üman" },
  { word: "Doƒüal", antonym: "Yapay" }, { word: "Doƒüu", antonym: "Batƒ±" }, { word: "Duru", antonym: "Bulanƒ±k" },
  { word: "Erken", antonym: "Ge√ß" }, { word: "Eski", antonym: "Yeni" }, { word: "Evet", antonym: "Hayƒ±r" },
  { word: "Fakir", antonym: "Zengin" }, { word: "Gelmek", antonym: "Gitmek" }, { word: "Gen√ß", antonym: "Ya≈ülƒ±" },
  { word: "Ger√ßek", antonym: "Yalan" }, { word: "Girmek", antonym: "√áƒ±kmak" }, { word: "G√ºlmek", antonym: "Aƒülamak" },
  { word: "G√ºney", antonym: "Kuzey" }, { word: "Hƒ±zlƒ±", antonym: "Yava≈ü" }, { word: "Islak", antonym: "Kuru" },
  { word: "ƒ∞nce", antonym: "Kalƒ±n" }, { word: "ƒ∞yi", antonym: "K√∂t√º" }, { word: "K√¢r", antonym: "Zarar" },
  { word: "Katƒ±", antonym: "Sƒ±vƒ±" }, { word: "Kolay", antonym: "Zor" }, { word: "Koyu", antonym: "A√ßƒ±k" },
  { word: "Kurnaz", antonym: "Saf" }, { word: "Masum", antonym: "Su√ßlu" }, { word: "Nazik", antonym: "Kaba" },
  { word: "Ne≈üeli", antonym: "√úzg√ºn" }, { word: "√ñd√ºl", antonym: "Ceza" }, { word: "√ñn", antonym: "Arka" },
  { word: "Pahalƒ±", antonym: "Ucuz" }, { word: "Parlak", antonym: "Mat" }, { word: "Sabah", antonym: "Ak≈üam" },
  { word: "Saƒü", antonym: "Sol" }, { word: "Saƒülam", antonym: "√á√ºr√ºk" }, { word: "Sert", antonym: "Yumu≈üak" },
  { word: "Sƒ±cak", antonym: "Soƒüuk" }, { word: "Soru", antonym: "Cevap" }, { word: "Taze", antonym: "Bayat" },
  { word: "Temiz", antonym: "Kirli" }, { word: "Usta", antonym: "Acemi" }, { word: "Uzun", antonym: "Kƒ±sa" },
  { word: "Var", antonym: "Yok" }, { word: "Yerli", antonym: "Yabancƒ±" }, { word: "Yoku≈ü", antonym: "ƒ∞ni≈ü" },
  { word: "A√ß", antonym: "Tok" }, { word: "Affetmek", antonym: "Cezalandƒ±rmak" }, { word: "Alƒ±cƒ±", antonym: "Satƒ±cƒ±" },
  { word: "Artmak", antonym: "Azalmak" }, { word: "Aydƒ±nlƒ±k", antonym: "Karanlƒ±k" }, { word: "Bek√¢r", antonym: "Evli" },
  { word: "Bencil", antonym: "Fedak√¢r" }, { word: "Bol", antonym: "Kƒ±t" }, { word: "Bo≈ü", antonym: "Dolu" },
  { word: "Bulmak", antonym: "Kaybetmek" }, { word: "Ceza", antonym: "√ñd√ºl" }, { word: "Cƒ±lƒ±z", antonym: "G√ºrb√ºz" },
  { word: "√áarpma", antonym: "B√∂lme" }, { word: "√áekmek", antonym: "ƒ∞tmek" }, { word: "√áift", antonym: "Tek" },
  { word: "√áukur", antonym: "T√ºmsek" }, { word: "Daƒüƒ±nƒ±k", antonym: "D√ºzenli" }, { word: "Dahi", antonym: "Aptal" },
  { word: "Darƒ±lmak", antonym: "Barƒ±≈ümak" }, { word: "Dert", antonym: "Derman" }, { word: "Dik", antonym: "Eƒüik" },
  { word: "Doƒüru", antonym: "Yanlƒ±≈ü" }, { word: "Donuk", antonym: "Parlak" }, { word: "Durgun", antonym: "Dalgalƒ±" },
  { word: "Eƒüri", antonym: "D√ºz" }, { word: "Erkek", antonym: "Kadƒ±n" }, { word: "Esaret", antonym: "√ñzg√ºrl√ºk" },
  { word: "Galip", antonym: "Maƒülup" }, { word: "Gece", antonym: "G√ºnd√ºz" }, { word: "Gerilemek", antonym: "ƒ∞lerlemek" },
  { word: "Geri", antonym: "ƒ∞leri" }, { word: "Gider", antonym: "Gelir" }, { word: "Gizli", antonym: "A√ßƒ±k" },
  { word: "Ham", antonym: "Olgun" }, { word: "Hayal", antonym: "Ger√ßek" }, { word: "Hatƒ±rlamak", antonym: "Unutmak" },
  { word: "Hƒ±r√ßƒ±n", antonym: "Uysal" }, { word: "ƒ∞√ß", antonym: "Dƒ±≈ü" }, { word: "ƒ∞lk", antonym: "Son" },
  { word: "ƒ∞yimser", antonym: "K√∂t√ºmser" }, { word: "Kalabalƒ±k", antonym: "Tenha" }, { word: "K√¢r", antonym: "Zarar" },
  { word: "Katƒ±", antonym: "Sƒ±vƒ±" }, { word: "Kaybetmek", antonym: "Kazanmak" }, { word: "Kƒ±≈ü", antonym: "Yaz" },
  { word: "Korku", antonym: "Cesaret" }, { word: "K√∂r", antonym: "G√∂ren" }, { word: "Kuru", antonym: "Ya≈ü" },
  { word: "K√ºsmek", antonym: "Barƒ±≈ümak" }, { word: "Medeni", antonym: "ƒ∞lkel" }, { word: "Mevcut", antonym: "Yok" },
  { word: "Minimum", antonym: "Maksimum" }, { word: "Negatif", antonym: "Pozitif" }, { word: "Ne≈üe", antonym: "Keder" },
  { word: "√ñl√º", antonym: "Diri" }, { word: "√ñzel", antonym: "Genel" }, { word: "√ñzg√ºr", antonym: "Tutsak" },
  { word: "Pahalƒ±", antonym: "Ucuz" }, { word: "Perakende", antonym: "Toptan" }, { word: "Ret", antonym: "Kabul" },
  { word: "Sabit", antonym: "Hareketli" }, { word: "Sade", antonym: "G√∂steri≈üli" }, { word: "Sahte", antonym: "Ger√ßek" },
  { word: "Saygƒ±lƒ±", antonym: "Saygƒ±sƒ±z" }, { word: "Sevin√ß", antonym: "√úz√ºnt√º" }, { word: "Sƒ±k", antonym: "Seyrek" },
  { word: "Somut", antonym: "Soyut" }, { word: "Sƒ±ƒü", antonym: "Derin" }, { word: "≈ûi≈üman", antonym: "Zayƒ±f" },
  { word: "Taze", antonym: "Kuru" }, { word: "Temiz", antonym: "Pis" }, { word: "Toplama", antonym: "√áƒ±karma" },
  { word: "Tutsak", antonym: "H√ºr" }, { word: "Ucuz", antonym: "Pahalƒ±" }, { word: "Unutmak", antonym: "Hatƒ±rlamak" },
  { word: "√úretim", antonym: "T√ºketim" }, { word: "Vah≈üi", antonym: "Evcil" }, { word: "Varƒ±≈ü", antonym: "Kalkƒ±≈ü" },
  { word: "Yaramaz", antonym: "Uslu" }, { word: "Yardƒ±msever", antonym: "Bencil" }, { word: "Yatay", antonym: "Dikey" },
  { word: "Yaz", antonym: "Kƒ±≈ü" }, { word: "Yerli", antonym: "Yabancƒ±" }, { word: "Yƒ±kmak", antonym: "Yapmak" },
  { word: "Yiƒüit", antonym: "Korkak" }, { word: "Yokluk", antonym: "Varlƒ±k" }, { word: "Zayƒ±f", antonym: "≈ûi≈üman" },
  { word: "Zemin", antonym: "Tavan" }, { word: "Zƒ±t", antonym: "E≈ü" }, { word: "Zirve", antonym: "Dip" }
];

const GlacierAntonymsHub = ({ onExit, onSaveScore }) => {
  const [appState, setAppState] = useState('menu'); 
  const [score, setScore] = useState(0);
  const [timer, setTimer] = useState(60);
  const [highScores, setHighScores] = useState({ classic: 0, match: 0, type: 0 });
  const timerRef = useRef(null);
  const [currentQuestion, setCurrentQuestion] = useState(null); 
  const [options, setOptions] = useState([]); 
  const [matchCards, setMatchCards] = useState([]); 
  const [selectedCards, setSelectedCards] = useState([]); 
  const [matchedPairs, setMatchedPairs] = useState([]); 
  const [userInput, setUserInput] = useState(""); 
  const [feedback, setFeedback] = useState(null);
  const [searchTerm, setSearchTerm] = useState("");

  useEffect(() => {
    const savedScores = JSON.parse(localStorage.getItem('buzulSkorlari')) || { classic: 0, match: 0, type: 0 };
    setHighScores(savedScores);
  }, []);

  const startGame = (mode) => {
    setScore(0);
    setTimer(mode === 'playing_match' ? 90 : 60);
    setAppState(mode);
    setFeedback(null);
    
    if (mode === 'playing_classic') generateClassicQuestion();
    if (mode === 'playing_match') generateMatchGrid();
    if (mode === 'playing_type') generateTypeQuestion();

    if (timerRef.current) clearInterval(timerRef.current);
    timerRef.current = setInterval(() => {
      setTimer((prev) => {
        if (prev <= 1) {
          endGame(mode);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
  };

  const endGame = (currentMode) => {
    clearInterval(timerRef.current);
    const modeKey = currentMode.replace('playing_', '');
    if (score > highScores[modeKey]) {
      const newScores = { ...highScores, [modeKey]: score };
      setHighScores(newScores);
      localStorage.setItem('buzulSkorlari', JSON.stringify(newScores));
    }
    setAppState('result');
  };

  const returnToMenu = () => { if (timerRef.current) clearInterval(timerRef.current); setAppState('menu'); };
  const returnToModeSelection = () => { if (timerRef.current) clearInterval(timerRef.current); setAppState('mode_selection'); };

  const generateClassicQuestion = () => {
    const questionPair = antonymPairs[Math.floor(Math.random() * antonymPairs.length)];
    let wrongOptions = [];
    while (wrongOptions.length < 3) {
      const randomWrong = antonymPairs[Math.floor(Math.random() * antonymPairs.length)];
      if (randomWrong.antonym !== questionPair.antonym && !wrongOptions.includes(randomWrong.antonym)) {
        wrongOptions.push(randomWrong.antonym);
      }
    }
    const allOptions = [...wrongOptions, questionPair.antonym].sort(() => Math.random() - 0.5);
    setCurrentQuestion(questionPair);
    setOptions(allOptions);
    setFeedback(null);
  };

  const handleClassicAnswer = (selectedOption) => {
    if (feedback) return;
    if (selectedOption === currentQuestion.antonym) {
      setScore(s => s + 10);
      setFeedback('correct');
      setTimeout(generateClassicQuestion, 500);
    } else {
      setFeedback('wrong');
      setTimer(t => Math.max(0, t - 5));
      setTimeout(generateClassicQuestion, 800);
    }
  };

  const generateMatchGrid = () => {
    const shuffledPairs = [...antonymPairs].sort(() => 0.5 - Math.random()).slice(0, 6);
    let cards = [];
    shuffledPairs.forEach((pair, index) => {
      cards.push({ id: `w-${index}`, content: pair.word, pairId: index, type: 'word' });
      cards.push({ id: `a-${index}`, content: pair.antonym, pairId: index, type: 'antonym' });
    });
    setMatchCards(cards.sort(() => 0.5 - Math.random()));
    setMatchedPairs([]);
    setSelectedCards([]);
  };

  const handleCardClick = (card) => {
    if (selectedCards.length >= 2 || matchedPairs.includes(card.pairId) || selectedCards.find(c => c.id === card.id)) return;
    const newSelected = [...selectedCards, card];
    setSelectedCards(newSelected);

    if (newSelected.length === 2) {
      if (newSelected[0].pairId === newSelected[1].pairId) {
        setScore(s => s + 20);
        setMatchedPairs([...matchedPairs, card.pairId]);
        setSelectedCards([]);
        if (matchedPairs.length + 1 === 6) {
           setTimeout(generateMatchGrid, 1000);
           setTimer(t => t + 10);
        }
      } else {
        setTimeout(() => setSelectedCards([]), 1000);
        setTimer(t => Math.max(0, t - 2)); 
      }
    }
  };

  const generateTypeQuestion = () => {
    const questionPair = antonymPairs[Math.floor(Math.random() * antonymPairs.length)];
    setCurrentQuestion(questionPair);
    setUserInput("");
    setFeedback(null);
  };

  const handleTypeSubmit = (e) => {
    e.preventDefault();
    if (feedback) return;
    const cleanInput = userInput.toLocaleLowerCase('tr').trim();
    const cleanAnswer = currentQuestion.antonym.toLocaleLowerCase('tr');
    const validSynonyms = synonymsDB[cleanAnswer] || [];
    if (cleanInput === cleanAnswer || validSynonyms.includes(cleanInput)) {
      setScore(s => s + 15);
      setFeedback('correct');
      setTimeout(generateTypeQuestion, 600);
    } else {
      setFeedback('wrong');
      setTimer(t => Math.max(0, t - 5));
      setTimeout(() => setFeedback(null), 800); 
      setTimeout(generateTypeQuestion, 800);
    }
  };

  const Snowfall = () => (
    <div className="absolute inset-0 pointer-events-none overflow-hidden z-0">
      {[...Array(25)].map((_, i) => (
        <div key={i} className="absolute text-white/30 animate-pulse"
             style={{ left: `${Math.random() * 100}%`, top: `${Math.random() * 100}%`, animationDuration: `${Math.random() * 5 + 3}s`, fontSize: `${Math.random() * 20 + 10}px` }}>
          <Snowflake />
        </div>
      ))}
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-cyan-100 via-blue-200 to-blue-400 font-sans relative overflow-hidden flex items-center justify-center p-2 md:p-4 select-none w-full">
      <Snowfall />

      <div className="relative z-10 w-full max-w-2xl bg-white/20 backdrop-blur-2xl border border-white/60 rounded-3xl shadow-2xl p-4 md:p-8 flex flex-col min-h-[550px]">
        
        {/* Header */}
        <div className="flex justify-between items-center mb-6 border-b border-white/30 pb-4">
          <div className="flex items-center gap-3">
             <div className="bg-blue-500 p-2 rounded-xl text-white shadow-lg"><Snowflake className="animate-spin-slow" /></div>
             <div>
               <h1 className="text-2xl font-black text-blue-900 leading-none">Buzul</h1>
               <span className="text-xs text-blue-700 font-bold tracking-widest">OYUN MERKEZƒ∞</span>
             </div>
          </div>
          {(appState.startsWith('playing')) ? (
            <div className="flex gap-3">
              <div className="bg-white/60 px-3 py-1 rounded-full text-blue-900 font-bold flex items-center gap-2 border border-white/50">
                <Trophy size={16} className="text-yellow-600" /> {score}
              </div>
              <div className="bg-red-100/80 px-3 py-1 rounded-full text-red-600 font-bold flex items-center gap-2 border border-red-200">
                <Clock size={16} /> {timer}
              </div>
            </div>
          ) : (
            <button onClick={onExit} className="text-blue-900 hover:bg-white/30 p-2 rounded-full">
                <LogOut size={24} />
            </button>
          )}
        </div>

        {/* Oyun ƒ∞√ßi Men√ºye D√∂n Butonu */}
        {appState.startsWith('playing') && (
          <div className="w-full flex justify-start mb-4">
             <button onClick={returnToModeSelection} className="flex items-center gap-2 text-blue-800 font-bold bg-white/40 hover:bg-white/60 px-3 py-1.5 rounded-lg transition-all text-sm border border-white/30 hover:shadow-md">
                <LogOut size={16} /> √áƒ±kƒ±≈ü / Mod Se√ßimi
             </button>
          </div>
        )}

        {/* --- EKRANLAR --- */}

        {/* 1. MEN√ú */}
        {appState === 'menu' && (
          <div className="flex-1 flex flex-col items-center justify-center space-y-6 animate-fade-in">
            <div className="text-center space-y-2">
              <h2 className="text-4xl font-bold text-blue-900 drop-shadow-sm">Kelime Bilgini Sƒ±na</h2>
              <p className="text-blue-800/80 max-w-md mx-auto">200'den fazla kelime √ßifti ile zƒ±t anlamlƒ±lar d√ºnyasƒ±nƒ± ke≈üfet. En y√ºksek puanƒ± topla, buzlarƒ± erit!</p>
            </div>
            
            <div className="w-full max-w-xs space-y-3">
              <button onClick={() => setAppState('mode_selection')}
                className="w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-2xl shadow-xl hover:scale-105 active:scale-95 transition-all font-bold text-xl flex items-center justify-center gap-3 group">
                <Play size={24} className="fill-current group-hover:animate-pulse" /> OYNA
              </button>

              <button onClick={() => setAppState('dictionary')}
                className="w-full py-3 bg-white/50 text-blue-900 rounded-2xl border border-white/60 hover:bg-white/80 transition-all font-bold text-lg flex items-center justify-center gap-3">
                <Book size={20} /> S√ñZL√úK
              </button>
            </div>
          </div>
        )}

        {/* 2. S√ñZL√úK MODU */}
        {appState === 'dictionary' && (
           <div className="flex-1 flex flex-col h-full animate-fade-in">
              <div className="flex justify-between items-center mb-4">
                 <button onClick={returnToMenu} className="text-blue-800 hover:text-blue-600 flex items-center gap-1 font-bold text-sm"><ChevronLeft size={16}/> Ana Men√º</button>
                 <h3 className="text-xl font-bold text-blue-900">Kelime S√∂zl√ºƒü√º</h3>
                 <div className="w-16"></div> 
              </div>

              <div className="relative mb-4">
                <input 
                  type="text" 
                  placeholder="Kelime ara..." 
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full pl-10 pr-4 py-3 rounded-xl border border-white/50 bg-white/60 focus:bg-white text-blue-900 placeholder-blue-400 outline-none focus:ring-2 ring-blue-300"
                />
                <Search className="absolute left-3 top-3.5 text-blue-400" size={18} />
              </div>

              <div className="flex-1 overflow-y-auto bg-white/40 rounded-xl border border-white/40 pr-1 max-h-[350px] scrollbar-thin scrollbar-thumb-blue-300 scrollbar-track-transparent">
                 <div className="grid grid-cols-1 gap-1 p-2">
                    {antonymPairs
                      .filter(p => p.word.toLocaleLowerCase('tr').includes(searchTerm.toLocaleLowerCase('tr')) || p.antonym.toLocaleLowerCase('tr').includes(searchTerm.toLocaleLowerCase('tr')))
                      .map((pair, idx) => (
                      <div key={idx} className="flex justify-between items-center bg-white/60 p-3 rounded-lg hover:bg-white/90 transition-colors">
                          <span className="font-bold text-blue-800">{pair.word}</span>
                          <div className="h-px flex-1 bg-blue-200 mx-4"></div>
                          <span className="font-bold text-cyan-700">{pair.antonym}</span>
                      </div>
                    ))}
                    {antonymPairs.filter(p => p.word.toLocaleLowerCase('tr').includes(searchTerm.toLocaleLowerCase('tr'))).length === 0 && (
                      <div className="text-center text-blue-800/60 p-4">Kelime bulunamadƒ±.</div>
                    )}
                 </div>
              </div>
           </div>
        )}

        {/* 3. MOD SE√áƒ∞Mƒ∞ */}
        {appState === 'mode_selection' && (
          <div className="flex-1 flex flex-col gap-4 animate-fade-in">
              <button onClick={() => setAppState('menu')} className="self-start text-blue-800 hover:text-blue-600 flex items-center gap-1 font-bold text-sm mb-2"><ChevronLeft size={16}/> Geri D√∂n</button>
              <h3 className="text-center text-xl font-bold text-blue-900 mb-4">Oyun Modunu Se√ß</h3>
              
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 h-full">
                {/* Klasik Kart */}
                <button onClick={() => startGame('playing_classic')} className="bg-gradient-to-b from-white/60 to-white/20 p-6 rounded-2xl border-2 border-white/50 hover:border-blue-400 hover:shadow-lg transition-all group text-left relative overflow-hidden">
                   <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity"><Brain size={80}/></div>
                   <div className="bg-blue-100 p-3 rounded-xl w-fit mb-3 text-blue-600 group-hover:scale-110 transition-transform"><Grid size={24}/></div>
                   <h4 className="text-lg font-bold text-blue-900">Klasik Buzul</h4>
                   <p className="text-sm text-blue-800/70 mt-1">Se√ßeneklerden doƒüru zƒ±t anlamlƒ±yƒ± bul.</p>
                   <div className="mt-4 text-xs font-bold text-yellow-700 bg-yellow-100/50 inline-block px-2 py-1 rounded">En Y√ºksek: {highScores.classic}</div>
                </button>

                {/* E≈üle≈ütirme Kart */}
                <button onClick={() => startGame('playing_match')} className="bg-gradient-to-b from-white/60 to-white/20 p-6 rounded-2xl border-2 border-white/50 hover:border-cyan-400 hover:shadow-lg transition-all group text-left relative overflow-hidden">
                   <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity"><Grid size={80}/></div>
                   <div className="bg-cyan-100 p-3 rounded-xl w-fit mb-3 text-cyan-600 group-hover:scale-110 transition-transform"><Grid size={24}/></div>
                   <h4 className="text-lg font-bold text-blue-900">Buz Kƒ±rma</h4>
                   <p className="text-sm text-blue-800/70 mt-1">Kartlarƒ± √ßevir, e≈üleri bul, buzlarƒ± kƒ±r.</p>
                   <div className="mt-4 text-xs font-bold text-yellow-700 bg-yellow-100/50 inline-block px-2 py-1 rounded">En Y√ºksek: {highScores.match}</div>
                </button>

                {/* Yazma Kart */}
                <button onClick={() => startGame('playing_type')} className="bg-gradient-to-b from-white/60 to-white/20 p-6 rounded-2xl border-2 border-white/50 hover:border-indigo-400 hover:shadow-lg transition-all group text-left relative overflow-hidden">
                   <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity"><Type size={80}/></div>
                   <div className="bg-indigo-100 p-3 rounded-xl w-fit mb-3 text-indigo-600 group-hover:scale-110 transition-transform"><Type size={24}/></div>
                   <h4 className="text-lg font-bold text-blue-900">Kar Fƒ±rtƒ±nasƒ±</h4>
                   <p className="text-sm text-blue-800/70 mt-1">Zor mod! Cevabƒ± kendin klavyeyle yaz.</p>
                   <div className="mt-4 text-xs font-bold text-yellow-700 bg-yellow-100/50 inline-block px-2 py-1 rounded">En Y√ºksek: {highScores.type}</div>
                </button>
             </div>
          </div>
        )}

        {/* 4. OYUN: KLASƒ∞K */}
        {appState === 'playing_classic' && currentQuestion && (
          <div className="flex-1 flex flex-col justify-center animate-slide-up">
            <div className="bg-white/40 p-8 rounded-2xl shadow-inner border border-white mb-6 text-center relative overflow-hidden">
               <span className="text-xs font-bold text-blue-500 uppercase tracking-widest">Kelime</span>
               <div className="text-4xl md:text-5xl font-black text-blue-900 mt-2">{currentQuestion.word}</div>
            </div>
            <div className="grid grid-cols-2 gap-4">
              {options.map((opt, idx) => {
                let statusClass = "bg-white/70 hover:bg-white text-blue-900 border-white";
                if (feedback === 'correct' && opt === currentQuestion.antonym) statusClass = "bg-green-500 text-white border-green-600 shadow-[0_0_15px_rgba(34,197,94,0.5)]";
                if (feedback === 'wrong' && opt !== currentQuestion.antonym) statusClass = "opacity-50";
                
                return (
                  <button key={idx} onClick={() => handleClassicAnswer(opt)} disabled={feedback !== null}
                    className={`p-4 rounded-xl border-b-4 font-bold text-lg transition-all active:border-b-0 active:translate-y-1 ${statusClass}`}>
                    {opt}
                  </button>
                );
              })}
            </div>
          </div>
        )}

        {/* 5. OYUN: E≈ûLE≈ûTƒ∞RME (BUZ KIRMA) */}
        {appState === 'playing_match' && (
          <div className="flex-1 grid grid-cols-3 md:grid-cols-4 gap-3 animate-fade-in content-center">
            {matchCards.map((card) => {
              const isFlipped = selectedCards.includes(card) || matchedPairs.includes(card.pairId);
              const isMatched = matchedPairs.includes(card.pairId);
              
              return (
                <button key={card.id} onClick={() => handleCardClick(card)} disabled={isFlipped}
                  className={`aspect-square md:aspect-video rounded-xl border-2 transition-all duration-300 transform perspective-1000 relative
                    ${isMatched ? 'opacity-0 scale-0' : 'opacity-100 scale-100'}
                    ${isFlipped ? 'bg-white border-blue-300 rotate-y-180' : 'bg-gradient-to-br from-blue-400 to-cyan-600 border-blue-300 hover:brightness-110'}
                  `}>
                  <div className="absolute inset-0 flex items-center justify-center">
                    {isFlipped ? (
                      <span className="font-bold text-blue-900 text-sm md:text-lg animate-fade-in">{card.content}</span>
                    ) : (
                      <Snowflake className="text-white/30 w-8 h-8 animate-pulse" />
                    )}
                  </div>
                </button>
              );
            })}
          </div>
        )}

        {/* 6. OYUN: YAZMA (KAR FIRTINASI) */}
        {appState === 'playing_type' && currentQuestion && (
           <div className="flex-1 flex flex-col justify-center items-center animate-slide-up space-y-6">
             <div className="w-full text-center">
               <div className="text-sm font-bold text-blue-600 mb-2">BU KELƒ∞MENƒ∞N ZIT ANLAMLI NEDƒ∞R?</div>
               <div className="text-5xl font-black text-blue-900 drop-shadow-md mb-8">{currentQuestion.word}</div>
               
               <form onSubmit={handleTypeSubmit} className="relative max-w-sm mx-auto">
                 <input 
                   type="text" 
                   value={userInput}
                   onChange={(e) => setUserInput(e.target.value)}
                   disabled={feedback !== null}
                   className={`w-full p-4 text-center text-2xl font-bold rounded-xl border-4 outline-none transition-colors 
                     ${feedback === 'correct' ? 'border-green-400 bg-green-50 text-green-700' : 
                       feedback === 'wrong' ? 'border-red-400 bg-red-50 text-red-700 animate-shake' : 
                       'border-blue-300 focus:border-blue-500 bg-white/80 text-blue-900'}
                   `}
                   placeholder="Cevabƒ± yaz..."
                   autoFocus
                 />
                 <button type="submit" className="absolute right-2 top-2 bottom-2 bg-blue-500 hover:bg-blue-600 text-white px-4 rounded-lg font-bold transition-colors">
                    Kontrol
                 </button>
               </form>
               
               <div className="h-8 mt-4">
                 {feedback === 'correct' && <div className="text-green-600 font-bold flex items-center justify-center gap-2"><CheckCircle size={20}/> Doƒüru! <span className="text-sm font-normal text-green-700 ml-2">({currentQuestion.antonym} = {userInput})</span></div>}
                 {feedback === 'wrong' && <div className="text-red-600 font-bold flex items-center justify-center gap-2"><XCircle size={20}/> Yanlƒ±≈ü! Doƒürusu: {currentQuestion.antonym}</div>}
               </div>
             </div>
             
             <div className="text-xs text-blue-800/60 bg-white/30 px-3 py-1 rounded-full">
               ƒ∞pucu: Kelimenin e≈ü anlamlƒ±sƒ±nƒ± yazarsan da kabul edilir.
             </div>
           </div>
        )}

        {/* 7. SONU√á EKRANI */}
        {appState === 'result' && (
          <div className="flex-1 flex flex-col items-center justify-center space-y-6 animate-fade-in">
            <div className="relative">
              <div className="absolute inset-0 bg-blue-400 blur-xl opacity-30 rounded-full"></div>
              <Trophy size={80} className="text-yellow-500 relative z-10 animate-bounce" />
            </div>
            
            <div className="text-center">
              <h2 className="text-3xl font-bold text-blue-900">S√ºre Doldu!</h2>
              <div className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500 mt-2">
                {score}
              </div>
              <p className="text-blue-700 font-medium">Toplam Puan</p>
            </div>

            <div className="flex flex-col gap-3 w-full max-w-sm">
                <button onClick={() => onSaveScore(score)}
                  className="w-full py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl shadow-lg transition-colors flex items-center justify-center gap-2 font-bold text-lg">
                  <Save size={20} />
                  Puanƒ± Kaydet ve √áƒ±k
                </button>

                <button onClick={() => setAppState('mode_selection')}
                  className="w-full py-3 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-xl transition-colors flex items-center justify-center gap-2 font-bold text-lg">
                  <RotateCcw size={20} />
                  Ba≈üka Bir Mod Dene
                </button>
            </div>
          </div>
        )}

      </div>
      
      <style>{`
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.4s ease-in-out; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .perspective-1000 { perspective: 1000px; }
        .scrollbar-thin::-webkit-scrollbar {
          width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
          background: transparent;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
          background-color: rgba(147, 197, 253, 0.5);
          border-radius: 20px;
        }
      `}</style>
    </div>
  );
};

// --- Yardƒ±mcƒ± API Fonksiyonu ---
const apiCall = async (payload) => {
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify(payload)
    });
    return await response.json();
  } catch (error) {
    console.error("API Hatasƒ±:", error);
    return { status: 'error', message: 'Baƒülantƒ± hatasƒ±' };
  }
};

// --- Alt Bile≈üenler ---

const LandingPage = ({ onLoginClick }) => (
  <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-blue-500 to-indigo-700 text-white relative overflow-hidden">
    <div className="absolute top-10 left-10 w-20 h-20 bg-white/10 rounded-full blur-xl animate-pulse"></div>
    <div className="absolute bottom-20 right-20 w-32 h-32 bg-yellow-400/20 rounded-full blur-xl animate-bounce"></div>
    <div className="z-10 text-center space-y-8 p-5 animate-fade-in-up">
      <h1 className="text-5xl md:text-7xl font-extrabold tracking-tight drop-shadow-lg">Eƒüitim Platformu</h1>
      <p className="text-xl md:text-2xl font-light text-blue-100 max-w-2xl mx-auto">
        Oyunlarla √∂ƒüren, kendini geli≈ütir ve ba≈üarƒ±larƒ±nƒ± takip et.
      </p>
      <button onClick={onLoginClick} className="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-indigo-600 transition-all duration-200 bg-white font-pj rounded-full focus:outline-none hover:scale-105 shadow-2xl">
        Giri≈ü Yap <Play className="ml-2 w-5 h-5 group-hover:translate-x-1 transition-transform" />
      </button>
    </div>
    <div className="absolute bottom-10 left-0 right-0 text-center">
      <p className="text-4xl md:text-6xl font-black tracking-[0.3em] opacity-30 select-none" style={{ fontFamily: 'Impact, sans-serif' }}>ARFSMTBL</p>
    </div>
  </div>
);

const LoginPage = ({ onLogin, error, isLoading, onBack }) => {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');

  const handleSubmit = () => onLogin(username, password);

  return (
    <div className="flex items-center justify-center min-h-screen bg-gray-50">
      <div className="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl border border-gray-100">
        <h2 className="text-3xl font-bold text-center text-gray-800 mb-6">Giri≈ü Yap</h2>
        <div className="space-y-4">
           <div>
             <label className="block text-sm font-medium text-gray-700 mb-1">Kullanƒ±cƒ± Adƒ±</label>
             <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Kullanƒ±cƒ± adƒ±nƒ±z" />
           </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">≈ûifre</label>
            <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="******" />
          </div>
          {error && <p className="text-red-500 text-sm text-center">{error}</p>}
          <button onClick={handleSubmit} disabled={isLoading} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition-colors shadow-lg flex justify-center items-center">
            {isLoading ? <Loader2 className="w-5 h-5 animate-spin" /> : "Giri≈ü Yap"}
          </button>
          <button onClick={onBack} className="w-full text-gray-500 text-sm hover:text-gray-700 py-2">Geri D√∂n</button>
        </div>
      </div>
    </div>
  );
};

const AdminPanel = ({ onLogout, onViewPlatform }) => {
  const [newStudentName, setNewStudentName] = useState('');
  const [newStudentPass, setNewStudentPass] = useState('');
  const [loading, setLoading] = useState(false);

  const handleAddStudent = async () => {
    if(!newStudentName || !newStudentPass) return;
    setLoading(true);
    const res = await apiCall({ action: 'addStudent', username: newStudentName, password: newStudentPass });
    setLoading(false);
    if(res.status === 'success') {
      alert("√ñƒürenci eklendi!");
      setNewStudentName('');
      setNewStudentPass('');
    } else {
      alert("Hata: " + res.message);
    }
  };

  return (
    <div className="min-h-screen bg-gray-50 p-4 md:p-8">
      <div className="max-w-4xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2"><UserCog className="w-8 h-8 text-indigo-600" /> Y√∂netici Paneli</h1>
          <div className="flex gap-2">
            <button onClick={onViewPlatform} className="px-4 py-2 bg-white text-indigo-600 rounded-lg shadow hover:bg-indigo-50 border border-indigo-100">Platformu G√∂r√ºnt√ºle</button>
            <button onClick={onLogout} className="px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200">√áƒ±kƒ±≈ü</button>
          </div>
        </div>

        <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-8">
          <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Users className="w-5 h-5" /> √ñƒürenci Ekle</h2>
          <div className="flex gap-2">
            <input placeholder="Kullanƒ±cƒ± Adƒ±" value={newStudentName} onChange={e => setNewStudentName(e.target.value)} className="flex-1 px-3 py-2 border rounded-lg text-sm" />
            <input placeholder="≈ûifre" value={newStudentPass} onChange={e => setNewStudentPass(e.target.value)} className="w-32 px-3 py-2 border rounded-lg text-sm" />
            <button onClick={handleAddStudent} disabled={loading} className="bg-green-500 text-white p-2 rounded-lg hover:bg-green-600 flex items-center justify-center w-12">
               {loading ? <Loader2 className="w-5 h-5 animate-spin" /> : <Plus className="w-5 h-5" />}
            </button>
          </div>
        </div>

        <div className="bg-blue-50 p-6 rounded-2xl border border-blue-100 text-sm text-blue-800">
            <h3 className="font-bold mb-2">üí° Bilgi:</h3>
            <p>Oyunlarƒ± ve istatistikleri y√∂netmek i√ßin l√ºtfen <strong>Google Sheet</strong> dosyanƒ±zƒ± kullanƒ±n.</p>
            <ul className="list-disc pl-5 mt-2 space-y-1">
                <li>Oyun eklemek i√ßin 'Games' sekmesine satƒ±r ekleyin.</li>
                <li>Eƒüer g√∂m√ºl√º bir oyun ekleyecekseniz, App.jsx dosyasƒ±ndaki <code>LOCAL_GAME_CODES</code> kƒ±smƒ±na HTML kodunu yapƒ±≈ütƒ±rƒ±n ve Sheet'e oyunun ID'sini girin.</li>
                <li>ƒ∞statistikleri 'Stats' sekmesinden g√∂rebilirsiniz.</li>
            </ul>
        </div>
      </div>
    </div>
  );
};

const Dashboard = ({ appUser, games, onLogout, onAdminPanel, onPlayGame, isLoadingGames }) => {
  const [selectedCategory, setSelectedCategory] = useState(null);
  
  const filteredGames = selectedCategory ? games.filter(g => g.category === selectedCategory) : [];

  return (
    <div className="min-h-screen bg-gray-100 flex flex-col">
      <header className="bg-white shadow-sm border-b sticky top-0 z-30">
        <div className="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
          <div className="flex items-center gap-3">
             <div className="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-700 font-bold text-xl">
               {appUser?.username?.charAt(0).toUpperCase()}
             </div>
             <div>
               <h1 className="font-bold text-gray-800 leading-tight">Merhaba, {appUser?.username}</h1>
               <p className="text-xs text-gray-500">ƒ∞yi dersler!</p>
             </div>
          </div>
          <div className="flex items-center gap-3">
             {appUser?.role === 'admin' && (
               <button onClick={onAdminPanel} className="p-2 text-indigo-600 hover:bg-indigo-50 rounded-full" title="Y√∂netici Paneli"><UserCog className="w-6 h-6" /></button>
             )}
             <button onClick={onLogout} className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-colors" title="√áƒ±kƒ±≈ü Yap"><LogOut className="w-6 h-6" /></button>
          </div>
        </div>
      </header>

      <main className="flex-1 max-w-7xl mx-auto px-4 py-8 w-full">
        {isLoadingGames ? (
            <div className="flex justify-center items-center h-64"><Loader2 className="w-10 h-10 animate-spin text-indigo-500" /></div>
        ) : !selectedCategory ? (
            <div className="space-y-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Dersini Se√ß ve Ba≈üla!</h2>
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    {CATEGORIES.map(cat => (
                        <div key={cat.name} onClick={() => setSelectedCategory(cat.name)} className={`cursor-pointer group relative overflow-hidden bg-white rounded-2xl p-6 shadow-sm hover:shadow-xl transition-all duration-300 border-2 ${cat.border || 'border-transparent'} flex flex-col items-center justify-center text-center h-48`}>
                            <div className={`w-20 h-20 rounded-full flex items-center justify-center mb-4 transition-transform duration-300 group-hover:scale-110 ${cat.color}`}>
                                <cat.icon className="w-10 h-10" />
                            </div>
                            <h3 className="text-lg font-bold text-gray-800 group-hover:text-indigo-600 transition-colors">{cat.name}</h3>
                        </div>
                    ))}
                </div>
            </div>
        ) : (
            <div>
                <div className="flex items-center gap-4 mb-6">
                    <button onClick={() => setSelectedCategory(null)} className="p-2 bg-white rounded-full hover:bg-gray-100 border border-gray-200 transition-colors"><ArrowLeft className="w-6 h-6 text-gray-600" /></button>
                    <div><h2 className="text-2xl font-bold text-gray-800">{selectedCategory}</h2><p className="text-gray-500 text-sm">Oyunlarƒ±</p></div>
                </div>
                {filteredGames.length > 0 ? (
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {filteredGames.map(game => (
                      <div key={game.id} className="bg-white rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 group">
                        <div className="h-32 bg-gray-100 relative overflow-hidden flex items-center justify-center">
                            <div className="absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 group-hover:scale-110 transition-transform duration-500" />
                            <Gamepad2 className="w-12 h-12 text-indigo-300 group-hover:text-indigo-500 transition-colors" />
                        </div>
                        <div className="p-5">
                          <h3 className="font-bold text-lg text-gray-800 mb-2 truncate" title={game.title}>{game.title}</h3>
                          <div className="flex justify-between items-center mt-4">
                            <span className="text-xs font-medium px-2 py-1 bg-gray-100 text-gray-600 rounded">{game.category}</span>
                            <button onClick={() => onPlayGame(game)} className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-indigo-200 transition-all active:scale-95">Oyna</button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="text-center py-20 bg-white rounded-3xl border border-dashed border-gray-300">
                    <div className="inline-block p-4 bg-gray-50 rounded-full mb-4"><Gamepad2 className="w-8 h-8 text-gray-400" /></div>
                    <h3 className="text-lg font-medium text-gray-900">Bu derste hen√ºz oyun yok.</h3>
                  </div>
                )}
            </div>
        )}
      </main>
    </div>
  );
};

const GameRunner = ({ activeGame, appUser, onClose }) => {
  const [isSaving, setIsSaving] = useState(false);

  // --- √ñZEL OYUN KONTROL√ú ---
  // Eƒüer oyun bir React bile≈üeni olarak mevcutsa, onu render et.
  if (activeGame.id === 'static-turkish-antonyms') {
      const handleSaveScore = async (finalScore) => {
        if(isSaving) return;
        setIsSaving(true);
        await apiCall({ 
          action: 'saveScore', 
          student: appUser.username, 
          gameTitle: activeGame.title, 
          category: activeGame.category, 
          score: finalScore 
        });
        alert(`Tebrikler! ${finalScore} puan kaydedildi.`);
        setIsSaving(false);
        onClose();
      };
      return <GlacierAntonymsHub onExit={onClose} onSaveScore={handleSaveScore} />;
  }

  // --- G√ñM√úL√ú OYUN KAYNAƒûI ---
  const gameSource = activeGame.type === 'local' 
    ? LOCAL_GAME_CODES[activeGame.id] // G√∂m√ºl√º oyun
    : null;

  const handleSaveScore = async (finalScore) => {
    if(isSaving) return;
    setIsSaving(true);
    await apiCall({ 
      action: 'saveScore', 
      student: appUser.username, 
      gameTitle: activeGame.title, 
      category: activeGame.category, 
      score: finalScore 
    });
    alert(`Tebrikler! ${finalScore} puan kaydedildi.`);
    setIsSaving(false);
    onClose();
  };

  return (
    <div className="flex flex-col h-screen bg-gray-900">
      <div className="bg-gray-800 text-white p-3 flex justify-between items-center shadow-lg">
        <span className="font-bold truncate max-w-md">{activeGame.title}</span>
        <button onClick={onClose} className="text-gray-400 hover:text-white text-sm">Kapat & √áƒ±k</button>
      </div>
      
      <div className="flex-1 relative bg-black flex items-center justify-center">
          {gameSource ? (
             // G√∂m√ºl√º oyun (srcDoc)
             <iframe 
                srcDoc={gameSource}
                className="w-full h-full border-0" 
                title={activeGame.title}
                allowFullScreen
             />
          ) : activeGame.url ? (
             // Dƒ±≈ü link oyunu
             <iframe 
                src={activeGame.url} 
                className="w-full h-full border-0" 
                title={activeGame.title}
                allowFullScreen
             />
          ) : (
             <div className="text-white">Oyun y√ºklenemedi.</div>
          )}
      </div>

      <div className="bg-gray-800 p-4 border-t border-gray-700 flex justify-end gap-4 items-center">
           <div className="text-gray-400 text-sm hidden sm:block">Oyun bittiƒüinde puanƒ±nƒ± kaydetmeyi unutma!</div>
           <div className="flex gap-2">
               <input type="number" placeholder="Puanƒ±n" id="manualScore" className="w-24 px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-indigo-500" />
               <button onClick={() => { const val = document.getElementById('manualScore').value; if(val) handleSaveScore(parseInt(val)); }} disabled={isSaving} className="bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-lg font-bold shadow-lg flex items-center gap-2">
                  {isSaving ? <Loader2 className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />} Kaydet
               </button>
           </div>
      </div>
    </div>
  );
};

// --- Ana Bile≈üen ---
export default function App() {
  const [appUser, setAppUser] = useState(null); 
  const [view, setView] = useState('landing'); 
  const [loginError, setLoginError] = useState('');
  const [isAuthLoading, setIsAuthLoading] = useState(false);
  const [games, setGames] = useState([]);
  const [isGamesLoading, setIsGamesLoading] = useState(false);
  const [activeGame, setActiveGame] = useState(null);

  // Oyunlarƒ± √áek
  useEffect(() => {
    if (appUser) {
      setIsGamesLoading(true);
      fetch(`${API_URL}?action=getData`)
        .then(res => res.json())
        .then(data => {
          if(data.status === 'success') {
            // Google Sheet'ten gelen oyunlar
            const dbGames = data.games;
            
            // Statik Oyunlar (Bile≈üen Olanlar)
            const staticTurkishGame = {
                id: 'static-turkish-antonyms',
                title: 'Buzul: Zƒ±t Anlamlƒ±lar',
                category: 'T√ºrk√ße',
                type: 'component', // Bu bir bile≈üen
                url: '' 
            };

            // Sheet'ten gelen + Statik Bile≈üen oyunlarƒ± birle≈ütir
            setGames([...dbGames, staticTurkishGame]);
          }
          setIsGamesLoading(false);
        })
        .catch(err => {
          console.error(err);
          setIsGamesLoading(false);
        });
    }
  }, [appUser]);

  const handleLogin = async (username, password) => {
    setLoginError('');
    setIsAuthLoading(true);
    const res = await apiCall({ action: 'login', username, password });
    setIsAuthLoading(false);
    
    if (res.status === 'success') {
      setAppUser({ username: res.username, role: res.role });
      setView(res.role === 'admin' ? 'admin' : 'dashboard');
    } else {
      setLoginError(res.message || 'Giri≈ü hatasƒ±');
    }
  };

  const handleLogout = () => { setAppUser(null); setView('landing'); setGames([]); };

  // --- Render Y√∂nlendirmesi ---
  switch (view) {
    case 'landing': return <LandingPage onLoginClick={() => setView('login')} />;
    case 'login': return <LoginPage onLogin={handleLogin} error={loginError} isLoading={isAuthLoading} onBack={() => setView('landing')} />;
    case 'admin': return <AdminPanel onLogout={handleLogout} onViewPlatform={() => setView('dashboard')} />;
    case 'dashboard': return <Dashboard appUser={appUser} games={games} isLoadingGames={isGamesLoading} onLogout={handleLogout} onAdminPanel={() => setView('admin')} onPlayGame={(g) => { setActiveGame(g); setView('game'); }} />;
    case 'game': return <GameRunner activeGame={activeGame} appUser={appUser} onClose={() => setView('dashboard')} />;
    default: return <LandingPage onLoginClick={() => setView('login')} />;
  }
}

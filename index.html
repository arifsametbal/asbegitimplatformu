<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eƒüitim Platformu</title>
    
    <!-- React ve Stil K√ºt√ºphaneleri -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* √ñzel Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- AYARLAR ---
        const API_URL = "https://script.google.com/macros/s/AKfycbzsrmvGlnyaZY8qS0fE76VKTNF0Ivd_G8VRHFJJCVnd7FcNS3aVzGD82qC8oS0R-bS2/exec";

        // --- OYUN KODLARI ---
        const ENGLISH_GAME_SOURCE = `
<!DOCTYPE html>
<html lang="tr">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fun English</title>
<style>body{font-family:'Comic Sans MS',sans-serif;background:#E0F7FA;text-align:center;padding:20px;color:#011627}.btn{background:#FF9F1C;border:none;padding:15px;border-radius:15px;color:white;font-weight:bold;cursor:pointer;margin:5px}.card-scene{width:200px;height:260px;margin:20px auto;perspective:1000px;cursor:pointer}.card-inner{width:100%;height:100%;transition:transform 0.6s;transform-style:preserve-3d;position:relative}.is-flipped .card-inner{transform:rotateY(180deg)}.card-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:15px;font-size:24px;box-shadow:0 4px 8px rgba(0,0,0,0.2)}.card-front{background:#FF9F1C;color:white}.card-back{background:#E71D36;color:white;transform:rotateY(180deg)}</style>
</head>
<body>
<div id="game"><h1>Fun English</h1><button class="btn" onclick="start()">Ba≈üla</button></div>
<script>
const words=[{en:"Apple",tr:"Elma",em:"üçé"},{en:"Cat",tr:"Kedi",em:"üê±"},{en:"Dog",tr:"K√∂pek",em:"üê∂"}];let idx=0;
function start(){document.getElementById('game').innerHTML='<div class="card-scene" onclick="this.classList.toggle(\\'is-flipped\\')"><div class="card-inner"><div class="card-face card-front"><div style="font-size:60px" id="em"></div><div id="en"></div></div><div class="card-face card-back"><div id="tr"></div></div></div></div><br><button class="btn" onclick="next()">Sonraki</button>';render();}
function render(){const w=words[idx];document.getElementById('em').innerText=w.em;document.getElementById('en').innerText=w.en;document.getElementById('tr').innerText=w.tr;}
function next(){idx=(idx+1)%words.length;render();document.querySelector('.card-scene').classList.remove('is-flipped');}
<\/script></body></html>`;

        const TURKISH_SYNONYM_GAME_SOURCE = `
<!DOCTYPE html>
<html lang="tr">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Galaktik</title>
<style>body{background:#0B0E14;color:white;font-family:sans-serif;text-align:center;padding:20px}h1{color:#00d2ff}.btn{background:linear-gradient(45deg,#00d2ff,#9b59b6);border:none;padding:10px 20px;color:white;border-radius:20px;cursor:pointer;font-weight:bold;margin:10px}.box{background:rgba(255,255,255,0.1);padding:20px;border-radius:15px;margin:20px auto;max-width:400px}</style>
</head>
<body>
<h1>ü™ê Galaktik Kelimeler</h1>
<div class="box"><p>Siyah kelimesinin e≈ü anlamlƒ±sƒ±?</p><button class="btn" onclick="res(true)">Kara</button> <button class="btn" onclick="res(false)">Beyaz</button><p id="fb"></p></div>
<script>function res(isTrue){document.getElementById('fb').innerText=isTrue?"‚úÖ Doƒüru!":"‚ùå Yanlƒ±≈ü";document.getElementById('fb').style.color=isTrue?"#0f0":"#f00";}
<\/script></body></html>`;

        const LOCAL_GAME_CODES = {
            'fun-english': ENGLISH_GAME_SOURCE,
            'static-turkish-synonyms-galactic': TURKISH_SYNONYM_GAME_SOURCE
        };

        // --- KATEGORƒ∞LER (FontAwesome ƒ∞konlarƒ± ile) ---
        const CATEGORIES = [
            { name: 'T√ºrk√ße', icon: 'fa-book-open', color: 'bg-red-100 text-red-600', border: 'border-red-200' },
            { name: 'Matematik', icon: 'fa-calculator', color: 'bg-blue-100 text-blue-600', border: 'border-blue-200' },
            { name: 'Fen Bilimleri', icon: 'fa-flask', color: 'bg-green-100 text-green-600', border: 'border-green-200' },
            { name: 'Hayat Bilgisi', icon: 'fa-earth-americas', color: 'bg-yellow-100 text-yellow-600', border: 'border-yellow-200' },
            { name: 'Sosyal Bilgiler', icon: 'fa-users', color: 'bg-orange-100 text-orange-600', border: 'border-orange-200' },
            { name: 'ƒ∞ngilizce', icon: 'fa-language', color: 'bg-purple-100 text-purple-600', border: 'border-purple-200' },
            { name: 'Bilsem', icon: 'fa-brain', color: 'bg-indigo-100 text-indigo-600', border: 'border-indigo-200' },
            { name: 'Zeka Oyunlarƒ±', icon: 'fa-puzzle-piece', color: 'bg-teal-100 text-teal-600', border: 'border-teal-200' },
            { name: 'G√∂rsel Sanatlar', icon: 'fa-palette', color: 'bg-pink-100 text-pink-600', border: 'border-pink-200' },
            { name: 'M√ºzik', icon: 'fa-music', color: 'bg-rose-100 text-rose-600', border: 'border-rose-200' },
            { name: 'Beden Eƒüitimi', icon: 'fa-person-running', color: 'bg-emerald-100 text-emerald-600', border: 'border-emerald-200' },
        ];

        // --- Bƒ∞LE≈ûENLER ---

        // 1. BUZUL OYUNU Bƒ∞LE≈ûENƒ∞ (React Component olarak)
        const GlacierAntonymsHub = ({ onExit, onSaveScore }) => {
            const [score, setScore] = useState(0);
            const [feedback, setFeedback] = useState("");
            
            const words = [
                {w: "Siyah", a: "Beyaz"}, {w: "A≈üaƒüƒ±", a: "Yukarƒ±"}, 
                {w: "Gel", a: "Git"}, {w: "Var", a: "Yok"}
            ];
            const [current, setCurrent] = useState(words[0]);

            const check = (ans) => {
                if(ans === current.a) {
                    setScore(s => s + 10);
                    setFeedback("‚úÖ Doƒüru!");
                    setTimeout(() => {
                        setCurrent(words[Math.floor(Math.random()*words.length)]);
                        setFeedback("");
                    }, 1000);
                } else {
                    setFeedback("‚ùå Yanlƒ±≈ü!");
                }
            };

            return (
                <div className="flex flex-col items-center justify-center h-full bg-gradient-to-b from-cyan-100 to-blue-200 p-4 rounded-xl">
                    <div className="bg-white p-8 rounded-2xl shadow-xl text-center max-w-md w-full">
                        <h2 className="text-3xl font-bold text-blue-600 mb-2">‚ùÑÔ∏è Buzul ‚ùÑÔ∏è</h2>
                        <p className="text-gray-500 mb-6">Zƒ±t Anlamlƒ±sƒ±nƒ± Bul</p>
                        
                        <div className="text-5xl font-black text-gray-800 mb-8">{current.w}</div>
                        
                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={() => check(current.a)} className="p-4 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition">{current.a}</button>
                            <button onClick={() => check("Yanlƒ±≈ü")} className="p-4 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition">Hata</button>
                        </div>
                        
                        <div className="mt-4 h-8 font-bold text-lg">{feedback}</div>
                        <div className="mt-4 text-xl">Puan: {score}</div>
                        
                        <button onClick={() => onSaveScore(score)} className="mt-6 w-full py-3 bg-green-500 text-white rounded-lg font-bold">Kaydet ve √áƒ±k</button>
                    </div>
                </div>
            );
        };

        // --- ANA UYGULAMA ---
        const App = () => {
            const [view, setView] = useState('landing'); // landing, login, dashboard, game
            const [user, setUser] = useState(null);
            const [games, setGames] = useState([]);
            const [activeGame, setActiveGame] = useState(null);
            const [loading, setLoading] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState(null);

            // Verileri √áek
            useEffect(() => {
                if (user) {
                    setLoading(true);
                    fetch(`${API_URL}?action=getData`)
                        .then(res => res.json())
                        .then(data => {
                            if (data.status === 'success') {
                                const staticGames = [
                                    { id: 'fun-english', title: 'Fun English', category: 'ƒ∞ngilizce', type: 'local' },
                                    { id: 'static-turkish-antonyms', title: 'Buzul: Zƒ±t Anlamlar', category: 'T√ºrk√ße', type: 'component' },
                                    { id: 'static-turkish-synonyms-galactic', title: 'Galaktik Kelimeler', category: 'T√ºrk√ße', type: 'local' }
                                ];
                                setGames([...data.games, ...staticGames]);
                            }
                            setLoading(false);
                        })
                        .catch(err => {
                            console.error(err);
                            setLoading(false);
                        });
                }
            }, [user]);

            const handleLogin = async (username, password) => {
                setLoading(true);
                try {
                    const res = await fetch(API_URL, {
                        method: 'POST',
                        body: JSON.stringify({ action: 'login', username, password })
                    }).then(r => r.json());

                    if (res.status === 'success') {
                        setUser({ username: res.username, role: res.role });
                        setView(res.role === 'admin' ? 'admin' : 'dashboard');
                    } else {
                        alert(res.message || 'Giri≈ü Ba≈üarƒ±sƒ±z');
                    }
                } catch (e) {
                    alert('Baƒülantƒ± hatasƒ±');
                }
                setLoading(false);
            };

            const saveScore = async (score) => {
                if (!user) return;
                try {
                    await fetch(API_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            action: 'saveScore',
                            student: user.username,
                            gameTitle: activeGame.title,
                            category: activeGame.category,
                            score: score
                        })
                    });
                    alert("Puan Kaydedildi!");
                    setView('dashboard');
                } catch (e) {
                    alert("Kaydetme hatasƒ±");
                }
            };

            // --- RENDER FONKSƒ∞YONLARI ---

            if (view === 'landing') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-blue-600 to-indigo-800 text-white p-4 text-center">
                        <h1 className="text-5xl md:text-7xl font-extrabold mb-4 drop-shadow-lg">Eƒüitim Platformu</h1>
                        <p className="text-xl mb-8 text-blue-100">Oyunlarla √∂ƒüren, kendini geli≈ütir.</p>
                        <button onClick={() => setView('login')} className="px-8 py-4 bg-white text-indigo-700 font-bold rounded-full shadow-lg hover:scale-105 transition transform text-lg">
                            Giri≈ü Yap <i className="fa-solid fa-play ml-2"></i>
                        </button>
                        <div className="absolute bottom-5 text-white/30 font-black tracking-widest text-4xl">ARFSMTBL</div>
                    </div>
                );
            }

            if (view === 'login') {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="w-full max-w-md bg-white p-8 rounded-2xl shadow-2xl">
                            <h2 className="text-3xl font-bold text-center mb-6 text-gray-800">Giri≈ü Yap</h2>
                            <input id="usr" className="w-full p-3 border rounded-lg mb-4" placeholder="Kullanƒ±cƒ± Adƒ±" />
                            <input id="pwd" type="password" className="w-full p-3 border rounded-lg mb-4" placeholder="≈ûifre" />
                            <button onClick={() => handleLogin(document.getElementById('usr').value, document.getElementById('pwd').value)} 
                                className="w-full bg-indigo-600 text-white p-3 rounded-lg font-bold hover:bg-indigo-700 transition flex justify-center">
                                {loading ? <i className="fa-solid fa-spinner fa-spin"></i> : 'Giri≈ü Yap'}
                            </button>
                            <button onClick={() => setView('landing')} className="w-full mt-2 text-gray-500 text-sm">Geri D√∂n</button>
                        </div>
                    </div>
                );
            }

            if (view === 'dashboard') {
                const filtered = selectedCategory ? games.filter(g => g.category === selectedCategory) : [];
                return (
                    <div className="min-h-screen flex flex-col">
                        <header className="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-10">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-700 font-bold text-xl">
                                    {user.username[0].toUpperCase()}
                                </div>
                                <div>
                                    <div className="font-bold text-gray-800">{user.username}</div>
                                    <div className="text-xs text-gray-500">√ñƒürenci Paneli</div>
                                </div>
                            </div>
                            <div className="flex gap-3">
                                {user.role === 'admin' && <button onClick={() => setView('admin')} className="p-2 text-indigo-600"><i className="fa-solid fa-gear fa-lg"></i></button>}
                                <button onClick={() => {setUser(null); setView('landing');}} className="p-2 text-red-500"><i className="fa-solid fa-right-from-bracket fa-lg"></i></button>
                            </div>
                        </header>

                        <main className="p-6 flex-1 max-w-6xl mx-auto w-full">
                            {!selectedCategory ? (
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {CATEGORIES.map(cat => (
                                        <div key={cat.name} onClick={() => setSelectedCategory(cat.name)} 
                                            className={`cursor-pointer bg-white p-6 rounded-2xl shadow-sm hover:shadow-xl transition border-2 ${cat.border} flex flex-col items-center justify-center h-48 text-center group`}>
                                            <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-4 text-2xl transition group-hover:scale-110 ${cat.color}`}>
                                                <i className={`fa-solid ${cat.icon}`}></i>
                                            </div>
                                            <h3 className="font-bold text-gray-800">{cat.name}</h3>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div>
                                    <button onClick={() => setSelectedCategory(null)} className="mb-4 flex items-center gap-2 text-gray-600 hover:text-black">
                                        <i className="fa-solid fa-arrow-left"></i> Derslere D√∂n
                                    </button>
                                    <h2 className="text-2xl font-bold mb-4">{selectedCategory} Oyunlarƒ±</h2>
                                    
                                    {loading ? <div className="text-center p-10"><i className="fa-solid fa-spinner fa-spin fa-2x text-indigo-500"></i></div> : 
                                     filtered.length === 0 ? <div className="text-center p-10 bg-white rounded-xl border border-dashed text-gray-500">Hen√ºz oyun yok.</div> :
                                     <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        {filtered.map(g => (
                                            <div key={g.id} className="bg-white rounded-xl shadow overflow-hidden group hover:shadow-lg transition">
                                                <div className="h-32 bg-gray-100 flex items-center justify-center text-indigo-300 group-hover:text-indigo-500 transition">
                                                    <i className="fa-solid fa-gamepad fa-3x"></i>
                                                </div>
                                                <div className="p-4">
                                                    <h3 className="font-bold text-gray-800">{g.title}</h3>
                                                    <button onClick={() => {setActiveGame(g); setView('game');}} className="mt-4 w-full bg-indigo-600 text-white py-2 rounded-lg font-bold hover:bg-indigo-700">Oyna</button>
                                                </div>
                                            </div>
                                        ))}
                                     </div>
                                    }
                                </div>
                            )}
                        </main>
                    </div>
                );
            }

            if (view === 'game') {
                // Eƒüer oyun bir React Bile≈üeni ise (√ñrn: Buzul)
                if(activeGame.type === 'component') {
                    return (
                        <div className="fixed inset-0 bg-white z-50 flex flex-col">
                            <button onClick={() => setView('dashboard')} className="absolute top-4 left-4 p-2 bg-gray-200 rounded-full hover:bg-gray-300 z-50"><i className="fa-solid fa-xmark"></i></button>
                            <GlacierAntonymsHub onExit={() => setView('dashboard')} onSaveScore={saveScore} />
                        </div>
                    );
                }

                // Eƒüer oyun g√∂m√ºl√º HTML ise
                const src = activeGame.type === 'local' ? LOCAL_GAME_CODES[activeGame.id] : activeGame.url;
                
                return (
                    <div className="fixed inset-0 bg-gray-900 z-50 flex flex-col">
                        <div className="bg-gray-800 text-white p-3 flex justify-between items-center shadow">
                            <span className="font-bold">{activeGame.title}</span>
                            <button onClick={() => setView('dashboard')} className="text-gray-400 hover:text-white">Kapat</button>
                        </div>
                        <div className="flex-1 bg-black relative">
                            {src ? (
                                <iframe srcDoc={activeGame.type === 'local' ? src : undefined} src={activeGame.type === 'link' ? src : undefined} className="w-full h-full border-0" allowFullScreen></iframe>
                            ) : <div className="text-white flex items-center justify-center h-full">Oyun y√ºklenemedi.</div>}
                        </div>
                        <div className="p-3 bg-gray-800 flex justify-end gap-2">
                            <input id="scoreInp" type="number" placeholder="Puan" className="px-3 rounded" />
                            <button onClick={() => saveScore(document.getElementById('scoreInp').value)} className="bg-green-600 text-white px-4 py-2 rounded font-bold">Kaydet</button>
                        </div>
                    </div>
                );
            }

            if (view === 'admin') {
                return (
                    <div className="p-8 max-w-4xl mx-auto">
                        <div className="flex justify-between items-center mb-8">
                            <h1 className="text-2xl font-bold">Y√∂netici Paneli</h1>
                            <div className="flex gap-2">
                                <button onClick={() => setView('dashboard')} className="px-4 py-2 bg-white border rounded shadow">Platform</button>
                                <button onClick={() => {setUser(null); setView('landing');}} className="px-4 py-2 bg-red-100 text-red-600 rounded">√áƒ±kƒ±≈ü</button>
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border mb-6">
                            <h3 className="font-bold mb-4">√ñƒürenci Ekle</h3>
                            <div className="flex gap-2">
                                <input id="newUsr" placeholder="Kullanƒ±cƒ± Adƒ±" className="border p-2 rounded flex-1" />
                                <input id="newPwd" placeholder="≈ûifre" className="border p-2 rounded w-32" />
                                <button onClick={async () => {
                                    setLoading(true);
                                    await fetch(API_URL, {method:'POST', body:JSON.stringify({action:'addStudent', username:document.getElementById('newUsr').value, password:document.getElementById('newPwd').value})});
                                    setLoading(false);
                                    alert('ƒ∞≈ülem Tamam');
                                }} className="bg-green-500 text-white p-2 rounded w-12">{loading ? '...' : '+'}</button>
                            </div>
                        </div>
                        <div className="bg-blue-50 p-4 rounded text-blue-800 text-sm">
                            <p><strong>Not:</strong> Oyunlarƒ± ve ƒ∞statistikleri y√∂netmek i√ßin l√ºtfen Google Sheet dosyanƒ±zƒ± kullanƒ±n.</p>
                        </div>
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
